{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 7407eef5bf64b56441a7","webpack:///./src/cottontail.js","webpack:///./src/core/node.js","webpack:///./src/core/ray.js","webpack:///./src/core/renderer.js","webpack:///./src/core/material.js","webpack:///./src/core/program.js","webpack:///./src/core/texture.js","webpack:///./src/geometry/primitive-stream.js","webpack:///./src/core/primitive.js","webpack:///./src/geometry/box-builder.js","webpack:///./src/materials/pbr.js","webpack:///./src/nodes/button-node.js","webpack:///./src/nodes/cube-sea.js","webpack:///./src/nodes/video.js","webpack:///./src/scenes/scene.js","webpack:///./src/nodes/bounds-renderer.js","webpack:///./src/nodes/input-renderer.js","webpack:///./src/nodes/skybox.js","webpack:///./src/nodes/stats-viewer.js","webpack:///./src/nodes/seven-segment-text.js","webpack:///./src/loaders/gltf2.js","webpack:///./src/scenes/gltf2.js"],"names":["window","XRWebGLLayer","prototype","getViewport","view","Node","Renderer","createWebGLContext","UrlTexture","PrimitiveStream","BoxBuilder","PbrMaterial","ButtonNode","CubeSea","VideoNode","WebXRView","Scene","GLTF2Scene","DEFAULT_TRANSLATION","Float32Array","DEFAULT_ROTATION","DEFAULT_SCALE","tmp_ray_matrix","mat4","create","tmp_ray_origin","vec3","name","children","parent","visible","selectable","_matrix","_dirty_trs","_translation","_rotation","_scale","_dirty_world_matrix","_world_matrix","_active_frame_id","_hover_frame_id","_render_primitives","_renderer","_select_handler","renderer","clearRenderPrimitives","onRendererChanged","child","_setRenderer","clone_node","copy","quat","primitive","addRenderPrimitive","addNode","clone","frame_id","markActive","value","removeNode","push","i","indexOf","splice","setMatrixDirty","fromRotationTranslationScale","child_promises","waitForComplete","Promise","all","then","_instances","index","length","ray_matrix","ray","_min","invert","world_matrix","multiply","intersection","intersectsAABB","_max","transformMat4","_hitTestSelectableNode","ray_origin","set","node","distance","result","child_result","hitTest","timestamp","frame_delta","onUpdate","_update","_updateLocalMatrix","mul","normal_mat","mat3","RAY_INTERSECTION_OFFSET","Ray","matrix","origin","_dir","fromMat4","transformMat3","dir","min","max","r","bounds","tmin","sign","inv_dir","tmax","tymin","tymax","tzmin","tzmax","t","Math","intersection_point","scale","add","normalize","fromValues","ATTRIB","POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","ATTRIB_MASK","DEF_LIGHT_DIR","DEF_LIGHT_COLOR","PRECISION_REGEX","RegExp","VERTEX_SHADER_SINGLE_ENTRY","VERTEX_SHADER_MULTI_ENTRY","FRAGMENT_SHADER_ENTRY","isPowerOfTwo","n","glAttribs","alpha","webglCanvas","document","createElement","contextTypes","webgl2","context","contextType","getContext","webglType","console","error","RenderView","projection_matrix","view_matrix","viewport","eye","_eye","_eye_index","RenderBuffer","target","usage","buffer","_target","_usage","_length","_buffer","_promise","resolve","RenderPrimitiveAttribute","primitive_attribute","_attrib_index","_component_count","component_count","_component_type","component_type","_stride","stride","_byte_offset","byte_offset","_normalized","normalized","RenderPrimitiveAttributeBuffer","_attributes","RenderPrimitive","_material","setPrimitive","_mode","mode","_element_count","element_count","_vao","_complete","_attribute_buffers","_attribute_mask","attributes","attribute","render_attribute","found_buffer","attribute_buffer","_index_buffer","_index_byte_offset","_index_type","index_buffer","index_byte_offset","index_type","material","program","reject","completion_promises","_sampler_dictionary","_uniform_dictionary","inverse_matrix","setCap","gl","gl_enum","cap","prev_state","state","change","enable","disable","RenderMaterialSampler","material_sampler","_uniform_name","_texture","_getRenderTexture","_index","RenderMaterialUniform","material_uniform","_uniform","_value","Array","RenderMaterial","_program","_state","_samplers","render_sampler","_uniforms","uniform","render_uniform","_complete_promise","_first_bind","_render_order","render_order","DEFAULT","BLEND","TRANSPARENT","OPAQUE","sampler","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","uniform1fv","uniform2fv","uniform3fv","uniform4fv","promises","other_state","CAPS_RANGE","BLEND_FUNC_RANGE","DEPTH_TEST","DEPTH_FUNC_RANGE","CULL_FACE","STENCIL_TEST","COLOR_MASK","DEPTH_MASK","STENCIL_MASK","DEPTH_FUNC_SHIFT","WebGLRenderingContext","NEVER","BLEND_SRC_RANGE","BLEND_SRC_SHIFT","BLEND_DST_RANGE","BLEND_DST_SHIFT","_gl","_frame_id","_program_cache","_texture_cache","_camera_positions","_vao_ext","getExtension","frag_high_precision","getShaderPrecisionFormat","FRAGMENT_SHADER","HIGH_FLOAT","_default_frag_precision","precision","_depth_mask_needs_reset","_color_mask_needs_reset","data","STATIC_DRAW","gl_buffer","createBuffer","render_buffer","bindBuffer","bufferData","byteLength","offset","bufferSubData","updateRenderBuffer","render_primitive","_getMaterialProgram","render_material","setRenderMaterial","mesh_node","createRenderPrimitive","views","root_node","vp","x","y","width","height","camera_position","render_primitives","_drawRenderPrimitiveSet","bindVertexArrayOES","depthMask","colorMask","attrib_mask","use","LIGHT_DIRECTION","LIGHT_COLOR","uniformMatrix4fv","PROJECTION_MATRIX","VIEW_MATRIX","CAMERA_POSITION","uniform1i","EYE_INDEX","eye_index","_bindMaterialState","bind","createVertexArrayOES","_bindPrimitive","instance","MODEL_MATRIX","drawElements","drawArrays","texture","key","texture_key","Error","texture_handle","createTexture","texImage2D","format","_type","_data","_setSamplerParameters","UNSIGNED_BYTE","source","updateFrame","_video","paused","waiting","setTimeout","addEventListener","power_of_two","mipmap","generateMipmap","min_filter","LINEAR_MIPMAP_LINEAR","LINEAR","wrap_s","REPEAT","CLAMP_TO_EDGE","wrap_t","texParameteri","TEXTURE_MAG_FILTER","mag_filter","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","defines","define","material_name","vertex_source","fragment_source","getProgramDefines","_getProgramKey","multiview","full_vertex_source","precision_match","match","frag_precision_header","full_fragment_source","onNextUse","attrib","enableVertexAttribArray","disableVertexAttribArray","ARRAY_BUFFER","vertexAttribPointer","ELEMENT_ARRAY_BUFFER","prev_material","_capsDiff","color_mask_change","mask","depth_mask_change","stencil_mask_change","stencilMask","_blendDiff","blendFunc","blend_func_src","blend_func_dst","_depthFuncDiff","depthFunc","depth_func","stateToBlendFunc","GL","CAP","MAT_STATE","RENDER_ORDER","SKY","ADDITIVE","shift","SRC_COLOR","MaterialState","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","LESS","MaterialSampler","uniform_name","MaterialUniform","default_value","Material","Program","vert_src","frag_src","attrib_map","createProgram","_first_use","_next_use_callbacks","defines_string","_vert_shader","createShader","VERTEX_SHADER","attachShader","shaderSource","compileShader","_frag_shader","attrib_name","bindAttribLocation","linkProgram","callback","getProgramParameter","LINK_STATUS","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","getProgramInfoLog","deleteProgram","attrib_count","ACTIVE_ATTRIBUTES","attrib_info","getActiveAttrib","getAttribLocation","uniform_count","ACTIVE_UNIFORMS","uniform_info","getActiveUniform","replace","getUniformLocation","deleteShader","useProgram","TextureSampler","Texture","RGBA","ImageTexture","img","_img","src","complete","naturalWidth","url","Image","BlobTexture","blob","URL","createObjectURL","VideoTexture","video","readyState","videoWidth","videoHeight","next_data_texture_index","DataTexture","type","_width","_height","_format","_key","ColorTexture","g","b","a","color_data","Uint8Array","temp_vec3","options","_vertices","_indices","_geometry_started","_vertex_offset","_vertex_index","_high_index","_flip_winding","_invert_normals","_transform","_normal_transform","z","u","v","nx","ny","nz","idx_a","idx_b","idx_c","vertex_buffer","createRenderBuffer","Uint16Array","attribs","FLOAT","setIndexBuffer","setBounds","GeometryBuilderBase","primitive_stream","_stream","finishPrimitive","clear","PrimitiveAttribute","Primitive","stream","w","h","d","wh","hh","dh","cx","cy","cz","startGeometry","idx","next_vertex_index","pushTriangle","pushVertex","endGeometry","center","size","hs","pushBox","VERTEX_SOURCE","EPIC_PBR_FUNCTIONS","FRAGMENT_SOURCE","base_color","defineSampler","metallic_roughness","normal","occlusion","emissive","base_color_factor","defineUniform","metallic_roughness_factor","occlusion_strength","emissive_factor","program_defines","BUTTON_SIZE","BUTTON_CORNER_RADIUS","BUTTON_CORNER_SEGMENTS","BUTTON_ICON_SIZE","BUTTON_LAYER_DISTANCE","BUTTON_COLOR","BUTTON_ALPHA","BUTTON_HOVER_COLOR","BUTTON_HOVER_ALPHA","BUTTON_HOVER_SCALE","BUTTON_HOVER_TRANSITION_TIME_MS","ButtonMaterial","blend","ButtonIconMaterial","icon","icon_texture","_icon_texture","_hovered","_hover_t","hd","ihs","segments","rad","PI","cos","sin","section","floor","button_primitive","_button_render_primitive","icon_primitive","icon_material","_icon_render_primitive","hover_amount","uniforms","hoverAmount","_updateHoverState","samplers","CubeSeaMaterial","heavy","heavy_gpu","cube_count","cube_scale","half_only","auto_rotate","image_url","_render_primitive","box_builder","pushCube","hero_primitive","hero_node","createMesh","rebuildCubes","cube_sea_node","half_grid","pos","cube_sea_primitive","fromRotation","VideoMaterial","image","tex_coord_scale_offset","_display_mode","display_mode","_video_texture","vertices","indices","pose","layer","projectionMatrix","getViewMatrix","_timestamp","_frame_delta","_stats_standing","_stats","_stats_enabled","enableStats","_stage_bounds","_bounds_renderer","_input_renderer","_reset_input_end_frame","_skybox","_gltf2_loader","_last_timestamp","_hover_frame","_hovered_nodes","clearColor","setRenderer","texture_loader","frame","frame_of_ref","session","getInputSources","input_sources","new_hovered_nodes","last_hover_frame","input_source","input_pose","getInputPose","gripMatrix","inputRenderer","addController","pointerMatrix","pointerOrigin","addLaserPointer","hit_result","addCursor","onHoverStart","cursor_pos","hover_node","onHoverEnd","handleSelectPointer","pointer_matrix","handleSelect","translation","fromEuler","rotation","stage_bounds","projection_mat","view_mat","drawViewArray","xr_frame","baseLayer","bindFramebuffer","FRAMEBUFFER","framebuffer","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","drawViews","prev_timestamp","performance","now","begin","reset","end","BoundsMaterial","ONE","depth_test","BoundsRenderer","verts","point_count","geometry","point","LASER_TEXTURE_DATA","LASER_LENGTH","LASER_DIAMETER","LASER_FADE_END","LASER_FADE_POINT","LASER_DEFAULT_COLOR","CURSOR_RADIUS","CURSOR_SHADOW_RADIUS","CURSOR_SHADOW_INNER_LUMINANCE","CURSOR_SHADOW_OUTER_LUMINANCE","CURSOR_SHADOW_INNER_OPACITY","CURSOR_SHADOW_OUTER_OPACITY","CURSOR_OPACITY","CURSOR_SEGMENTS","CURSOR_DEFAULT_COLOR","CURSOR_DEFAULT_HIDDEN_COLOR","DEFAULT_RESET_OPTIONS","controllers","lasers","cursors","LaserMaterial","cull_face","depth_mask","laser","laser_color","CURSOR_VERTEX_SHADER","CURSOR_FRAGMENT_SHADER","CursorMaterial","cursor_color","CursorHiddenMaterial","GEQUAL","InputRenderer","_max_input_elements","_controllers","_controller_node","_controller_node_handedness","_lasers","_cursors","_active_controllers","_active_lasers","_active_cursors","controller_node","handedness","grip_matrix","controller","_createLaserMesh","_createCursorMesh","cursor","lr","ll","laser_verts","laser_indices","laser_vertex_buffer","laser_index_buffer","laser_index_count","laser_attribs","laser_primitive","laser_material","laser_render_primitive","cr","cursor_verts","cursor_indices","seg_rad","index_offset","cursor_vertex_buffer","cursor_index_buffer","cursor_index_count","cursor_attribs","cursor_primitive","cursor_material","cursor_hidden_material","cursor_render_primitive","cursor_hidden_render_primitive","SkyboxMaterial","LEQUAL","Skybox","_image_url","_rotation_y","rotation_y","lat_segments","lon_segments","theta","sin_theta","cos_theta","idx_offset_a","idx_offset_b","j","phi","SEGMENTS","MAX_FPS","StatsMaterial","segmentToX","fpsToY","fpsToRGB","Date","StatsViewer","_performance_monitoring","_start_time","_prev_frame_time","_prev_graph_update_time","_frames","_fps_average","_fps_min","_fps_step","_last_segment","_fps_vertex_buffer","_fps_render_primitive","_fps_node","_seven_segment_node","clearNodes","fps_verts","fps_indices","addBGSquare","left","bottom","right","top","DYNAMIC_DRAW","fps_index_buffer","fps_attribs","fps_primitive","time","frame_fps","interval_time","round","_updateGraph","enable_performance_monitoring","log","value_low","value_high","color","y0","y1","updateVerts","text","TEXT_KERNING","SevenSegmentMaterial","SevenSegmentText","_text","_char_nodes","segmentIndices","thickness","defineSegment","id","characters","defineCharacter","c","character","count","segment","apply","vertex_attribs","_char_primitives","char","char_def","char_primitive","GLB_MAGIC","CHUNK_TYPE","JSON","BIN","isAbsoluteUri","uri","absRegEx","location","protocol","isDataUri","dataRegEx","resolveUri","baseUrl","getComponentCount","GLTF2Loader","fetch","response","lastIndexOf","substring","endsWith","json","loadFromJson","arrayBuffer","loadFromBinary","headerView","DataView","magic","getUint32","version","chunks","chunkOffset","chunkHeaderView","chunkLength","chunkType","slice","decoder","TextDecoder","jsonString","decode","parse","binaryChunk","asset","minVersion","buffers","GLTF2Resource","bufferViews","bufferView","GLTF2BufferView","images","textures","glTexture","minFilter","magFilter","wrapS","wrapT","getTexture","textureInfo","materials","glMaterial","pbr","pbrMetallicRoughness","baseColorFactor","baseColorTexture","metallicFactor","roughnessFactor","metallicRoughnessTexture","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","alphaMode","doubleSided","accessors","meshes","mesh","glMesh","GLTF2Mesh","primitives","accessor","glAttribute","renderBuffer","componentType","byteStride","byteOffset","glPrimitive","indexType","indexByteOffset","scene_node","scene","scenes","nodes","nodeId","processNodes","glNode","_viewPromise","_renderBuffer","dataView","_dataPromise","base64String","binaryArray","from","atob","charCodeAt","Blob","mimeType","gltf_node","gltf2Loader","loadFromUrl"],"mappings":"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","file":"cottontail.debug.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7407eef5bf64b56441a7","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { Node } from './core/node.js'\nimport { Renderer, createWebGLContext } from './core/renderer.js'\nimport { UrlTexture } from './core/texture.js'\n\nimport { PrimitiveStream } from './geometry/primitive-stream.js'\nimport { BoxBuilder } from './geometry/box-builder.js'\n\nimport { PbrMaterial } from './materials/pbr.js'\n\nimport { ButtonNode } from './nodes/button-node.js'\nimport { CubeSea } from './nodes/cube-sea.js'\nimport { VideoNode } from './nodes/video.js'\n\nimport { WebXRView, Scene } from './scenes/scene.js'\nimport { GLTF2Scene } from './scenes/gltf2.js'\n\n// A very short-term polyfill to address a change in the location of the\n// getViewport call. This should dissapear within a month or so.\nif (('XRWebGLLayer' in window) && !('getViewport' in XRWebGLLayer.prototype)) {\n  XRWebGLLayer.prototype.getViewport = function(view) {\n    return view.getViewport(this);\n  };\n}\n\nexport {\n  Node,\n  Renderer,\n  createWebGLContext,\n  UrlTexture,\n\n  PrimitiveStream,\n  BoxBuilder,\n\n  PbrMaterial,\n\n  ButtonNode,\n  CubeSea,\n  VideoNode,\n\n  WebXRView,\n  Scene,\n  GLTF2Scene\n};\n\n\n// WEBPACK FOOTER //\n// ./src/cottontail.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { Ray } from './ray.js'\n\nconst DEFAULT_TRANSLATION = new Float32Array([0, 0, 0]);\nconst DEFAULT_ROTATION = new Float32Array([0, 0, 0, 1]);\nconst DEFAULT_SCALE = new Float32Array([1, 1, 1]);\n\nlet tmp_ray_matrix = mat4.create();\nlet tmp_ray_origin = vec3.create();\n\nexport class Node {\n  constructor() {\n    this.name = null; // Only for debugging\n    this.children = [];\n    this.parent = null;\n    this.visible = true;\n    this.selectable = false;\n\n    this._matrix = null;\n\n    this._dirty_trs = false;\n    this._translation = null;\n    this._rotation = null;\n    this._scale = null;\n\n    this._dirty_world_matrix = false;\n    this._world_matrix = null;\n\n    this._active_frame_id = -1;\n    this._hover_frame_id = -1;\n    this._render_primitives = null;\n    this._renderer = null;\n\n    this._select_handler = null;\n  }\n\n  _setRenderer(renderer) {\n    if (this._renderer == renderer)\n      return;\n\n    if (this._renderer) {\n      // Changing the renderer removes any previously attached renderPrimitives\n      // from a different renderer.\n      this.clearRenderPrimitives();\n    }\n\n    this._renderer = renderer;\n    if (renderer) {\n      this.onRendererChanged(renderer);\n\n      for (let child of this.children) {\n        child._setRenderer(renderer);\n      }\n    }\n  }\n\n  onRendererChanged(renderer) {\n    // Override in other node types to respond to changes in the renderer.\n  }\n\n  // Create a clone of this node and all of it's children. Does not duplicate\n  // RenderPrimitives, the cloned nodes will be treated as new instances of the\n  // geometry.\n  clone() {\n    let clone_node = new Node();\n    clone_node.name = this.name;\n    clone_node.visible = this.visible;\n    clone_node._renderer = this._renderer;\n\n    clone_node._dirty_trs = this._dirty_trs;\n\n    if (this._translation) {\n      clone_node._translation = vec3.create();\n      vec3.copy(clone_node._translation, this._translation);\n    }\n\n    if (this._rotation) {\n      clone_node._rotation = quat.create();\n      quat.copy(clone_node._rotation, this._rotation);\n    }\n\n    if (this._scale) {\n      clone_node._scale = vec3.create();\n      vec3.copy(clone_node._scale, this._scale);\n    }\n\n    // Only copy the matrices if they're not already dirty.\n    if (!clone_node._dirty_trs && this._matrix) {\n      clone_node._matrix = mat4.create();\n      mat4.copy(clone_node._matrix, this._matrix);\n    }\n\n    clone_node._dirty_world_matrix = this._dirty_world_matrix;\n    if (!clone_node._dirty_world_matrix && this._world_matrix) {\n      clone_node._world_matrix = mat4.create();\n      mat4.copy(clone_node._world_matrix, this._world_matrix);\n    }\n\n    if (this._render_primitives) {\n      for (let primitive of this._render_primitives) {\n        clone_node.addRenderPrimitive(primitive);\n      }\n    }\n\n    for (let child of this.children) {\n      clone_node.addNode(child.clone());\n    }\n\n    return clone_node;\n  }\n\n  markActive(frame_id) {\n    if (this.visible && this._render_primitives) {\n      this._active_frame_id = frame_id;\n      for (let primitive of this._render_primitives) {\n        primitive.markActive(frame_id);\n      }\n    }\n\n    for (let child of this.children) {\n      if (child.visible) {\n        child.markActive(frame_id);\n      }\n    }\n  }\n\n  addNode(value) {\n    if (!value || value.parent == this) {\n      return;\n    }\n\n    if (value.parent) {\n      value.parent.removeNode(value);\n    }\n    value.parent = this;\n\n    this.children.push(value);\n\n    if (this._renderer) {\n      value._setRenderer(this._renderer);\n    }\n  }\n\n  removeNode(value) {\n    let i = this.children.indexOf(value);\n    if (i > -1) {\n      this.children.splice(i, 1);\n      value.parent = null;\n    }\n  }\n\n  clearNodes() {\n    for (let child of this.children) {\n      child.parent = null;\n    }\n    this.children = [];\n  }\n\n  setMatrixDirty() {\n    if (!this._dirty_world_matrix) {\n      this._dirty_world_matrix = true;\n      for (let child of this.children) {\n        child.setMatrixDirty();\n      }\n    }\n  }\n\n  _updateLocalMatrix() {\n    if (!this._matrix) {\n      this._matrix = mat4.create();\n    }\n\n    if (this._dirty_trs) {\n      this._dirty_trs = false;\n      mat4.fromRotationTranslationScale(\n        this._matrix,\n        this._rotation || DEFAULT_ROTATION,\n        this._translation || DEFAULT_TRANSLATION,\n        this._scale || DEFAULT_SCALE);\n    }\n\n    return this._matrix;\n  }\n\n  set matrix(value) {\n    this._matrix = value;\n    this.setMatrixDirty();\n    this._dirty_trs = false;\n    this._translation = null;\n    this._rotation = null;\n    this._scale = null;\n  }\n\n  get matrix() {\n    this.setMatrixDirty();\n\n    return this._updateLocalMatrix();\n  }\n\n  get world_matrix() {\n    if (!this._world_matrix) {\n      this._dirty_world_matrix = true;\n      this._world_matrix = mat4.create();\n    }\n\n    if (this._dirty_world_matrix || this._dirty_trs) {\n      if (this.parent) {\n        // TODO: Some optimizations that could be done here if the node matrix\n        // is an identity matrix.\n        mat4.mul(this._world_matrix, this.parent.world_matrix, this._updateLocalMatrix());\n      } else {\n        mat4.copy(this._world_matrix, this._updateLocalMatrix());\n      }\n      this._dirty_world_matrix = false;\n    }\n\n    return this._world_matrix;\n  }\n\n  // TODO: Decompose matrix when fetching these?\n  set translation(value) {\n    if (value != null) {\n      this._dirty_trs = true;\n      this.setMatrixDirty();\n    }\n    this._translation = value;\n  }\n\n  get translation() {\n    this._dirty_trs = true;\n    this.setMatrixDirty();\n    if (!this._translation) {\n      this._translation = vec3.clone(DEFAULT_TRANSLATION);\n    }\n    return this._translation;\n  }\n\n  set rotation(value) {\n    if (value != null) {\n      this._dirty_trs = true;\n      this.setMatrixDirty();\n    }\n    this._rotation = value;\n  }\n\n  get rotation() {\n    this._dirty_trs = true;\n    this.setMatrixDirty();\n    if (!this._rotation) {\n      this._rotation = quat.clone(DEFAULT_ROTATION);\n    }\n    return this._rotation;\n  }\n\n  set scale(value) {\n    if (value != null) {\n      this._dirty_trs = true;\n      this.setMatrixDirty();\n    }\n    this._scale = value;\n  }\n\n  get scale() {\n    this._dirty_trs = true;\n    this.setMatrixDirty();\n    if (!this._scale) {\n      this._scale = vec3.clone(DEFAULT_SCALE);\n    }\n    return this._scale;\n  }\n\n  waitForComplete() {\n    let child_promises = [];\n    for (let child of this.children) {\n      child_promises.push(child.waitForComplete());\n    }\n    if (this._render_primitives) {\n      for (let primitive of this._render_primitives) {\n        child_promises.push(primitive.waitForComplete());\n      }\n    }\n    return Promise.all(child_promises).then(() => this);\n  }\n\n  get renderPrimitives() {\n    return this._render_primitives;\n  }\n\n  addRenderPrimitive(primitive) {\n    if (!this._render_primitives)\n      this._render_primitives = [primitive];\n    else\n      this._render_primitives.push(primitive);\n    primitive._instances.push(this);\n  }\n\n  removeRenderPrimitive(primitive) {\n    if (!this._render_primitives)\n      return;\n\n    let index = this._render_primitives._instances.indexOf(primitive);\n    if (index > -1) {\n      this._render_primitives._instances.splice(index, 1);\n\n      index = primitive._instances.indexOf(this);\n      if (index > -1) {\n        primitive._instances.splice(index, 1);\n      }\n\n      if (!this._render_primitives.length)\n        this._render_primitives = null;\n    }\n  }\n\n  clearRenderPrimitives() {\n    if (this._render_primitives) {\n      for (let primitive of this._render_primitives) {\n        let index = primitive._instances.indexOf(this);\n        if (index > -1) {\n          primitive._instances.splice(index, 1);\n        }\n      }\n      this._render_primitives = null;\n    }\n  }\n\n  _hitTestSelectableNode(ray_matrix) {\n    if (this._render_primitives) {\n      let ray = null;\n      for (let primitive of this._render_primitives) {\n        if (primitive._min) {\n          if (!ray) {\n            mat4.invert(tmp_ray_matrix, this.world_matrix);\n            mat4.multiply(tmp_ray_matrix, tmp_ray_matrix, ray_matrix);\n            ray = new Ray(tmp_ray_matrix);\n          }\n          let intersection = ray.intersectsAABB(primitive._min, primitive._max);\n          if (intersection) {\n            vec3.transformMat4(intersection, intersection, this.world_matrix);\n            return intersection;\n          }\n        }\n      }\n    }\n    for (let child of this.children) {\n      let intersection = child._hitTestSelectableNode(ray_matrix);\n      if (intersection) {\n        return intersection;\n      }\n    }\n    return null;\n  }\n\n  hitTest(ray_matrix, ray_origin = null) {\n    if (!ray_origin) {\n      ray_origin = tmp_ray_origin;\n      vec3.set(ray_origin, 0, 0, 0);\n      vec3.transformMat4(ray_origin, ray_origin, ray_matrix);\n    }\n\n    if (this.selectable && this.visible) {\n      let intersection = this._hitTestSelectableNode(ray_matrix);\n      if (intersection) {\n        return {\n          node: this,\n          intersection: intersection,\n          distance: vec3.distance(ray_origin, intersection),\n        };\n      }\n      return null;\n    }\n\n    let result = null;\n    for (let child of this.children) {\n      let child_result = child.hitTest(ray_matrix, ray_origin);\n      if (child_result) {\n        if (!result || result.distance > child_result.distance) {\n          result = child_result;\n        }\n      }\n    }\n    return result;\n  }\n\n  onSelect(value) {\n    this._select_handler = value;\n  }\n\n  get selectHandler() {\n    return this._select_handler;\n  }\n\n  // Called when a selectable node is selected.\n  handleSelect() {\n    if (this._select_handler)\n      this._select_handler();\n  }\n\n  // Called when a selectable element is pointed at.\n  onHoverStart() {\n\n  }\n\n  // Called when a selectable element is no longer pointed at.\n  onHoverEnd() {\n\n  }\n\n  _update(timestamp, frame_delta) {\n    this.onUpdate(timestamp, frame_delta);\n\n    for (let child of this.children) {\n      child._update(timestamp, frame_delta);\n    }\n  }\n\n  // Called every frame so that the nodes can animate themselves\n  onUpdate(timestamp, frame_delta) {\n\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/core/node.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nlet normal_mat = mat3.create();\n\nconst RAY_INTERSECTION_OFFSET = 0.02;\n\nexport class Ray {\n  constructor(matrix = null) {\n    this.origin = vec3.create();\n\n    this._dir = vec3.create();\n    this._dir[2] = -1.0;\n\n    if (matrix) {\n      vec3.transformMat4(this.origin, this.origin, matrix);\n      mat3.fromMat4(normal_mat, matrix);\n      vec3.transformMat3(this._dir, this._dir, normal_mat);\n    }\n\n    // To force the inverse and sign calculations.\n    this.dir = this._dir;\n  }\n\n  get dir() {\n    return this._dir;\n  }\n\n  set dir(value) {\n    this._dir = vec3.copy(this._dir, value);\n    vec3.normalize(this._dir, this._dir);\n\n    this.inv_dir = vec3.fromValues(\n      1.0 / this._dir[0],\n      1.0 / this._dir[1],\n      1.0 / this._dir[2]);\n\n    this.sign = [\n      (this.inv_dir[0] < 0) ? 1 : 0,\n      (this.inv_dir[1] < 0) ? 1 : 0,\n      (this.inv_dir[2] < 0) ? 1 : 0\n    ];\n  }\n\n  // Borrowed from:\n  // https://www.scratchapixel.com/lessons/3d-basic-rendering/minimal-ray-tracer-rendering-simple-shapes/ray-box-intersection\n  intersectsAABB(min, max) {\n    let r = this;\n\n    let bounds = [min, max];\n\n    let tmin = (bounds[r.sign[0]][0] - r.origin[0]) * r.inv_dir[0];\n    let tmax = (bounds[1-r.sign[0]][0] - r.origin[0]) * r.inv_dir[0];\n    let tymin = (bounds[r.sign[1]][1] - r.origin[1]) * r.inv_dir[1];\n    let tymax = (bounds[1-r.sign[1]][1] - r.origin[1]) * r.inv_dir[1];\n\n    if ((tmin > tymax) || (tymin > tmax))\n        return null;\n    if (tymin > tmin)\n        tmin = tymin;\n    if (tymax < tmax)\n        tmax = tymax;\n\n    let tzmin = (bounds[r.sign[2]][2] - r.origin[2]) * r.inv_dir[2];\n    let tzmax = (bounds[1-r.sign[2]][2] - r.origin[2]) * r.inv_dir[2];\n\n    if ((tmin > tzmax) || (tzmin > tmax))\n        return null;\n    if (tzmin > tmin)\n        tmin = tzmin;\n    if (tzmax < tmax)\n        tmax = tzmax;\n\n    let t = -1;\n    if (tmin > 0 && tmax > 0) {\n      t = Math.min(tmin, tmax);\n    } else if (tmin > 0) {\n      t = tmin;\n    } else if (tmax > 0) {\n      t = tmax;\n    } else {\n      // Intersection is behind the ray origin.\n      return null;\n    }\n\n    // Push ray intersection point back along the ray a bit so that cursors\n    // don't accidentally intersect with the hit surface.\n    t -= RAY_INTERSECTION_OFFSET;\n\n    // Return the point where the ray first intersected with the AABB.\n    let intersection_point = vec3.clone(this._dir);\n    vec3.scale(intersection_point, intersection_point, t);\n    vec3.add(intersection_point, intersection_point, this.origin);\n    return intersection_point;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/ray.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { CAP, MAT_STATE, RENDER_ORDER, stateToBlendFunc } from './material.js'\nimport { Node } from './node.js'\nimport { Program } from './program.js'\nimport { DataTexture, VideoTexture } from './texture.js'\n\nexport const ATTRIB = {\n  POSITION: 1,\n  NORMAL: 2,\n  TANGENT: 3,\n  TEXCOORD_0: 4,\n  TEXCOORD_1: 5,\n  COLOR_0: 6,\n};\n\nexport const ATTRIB_MASK = {\n  POSITION:   0x0001,\n  NORMAL:     0x0002,\n  TANGENT:    0x0004,\n  TEXCOORD_0: 0x0008,\n  TEXCOORD_1: 0x0010,\n  COLOR_0:    0x0020,\n};\n\nconst DEF_LIGHT_DIR = new Float32Array([-0.1, -1.0, -0.2]);\nconst DEF_LIGHT_COLOR = new Float32Array([1.0, 1.0, 0.9]);\n\nconst PRECISION_REGEX = new RegExp('precision (lowp|mediump|highp) float;');\n\nconst VERTEX_SHADER_SINGLE_ENTRY = `\nuniform mat4 PROJECTION_MATRIX, VIEW_MATRIX, MODEL_MATRIX;\n\nvoid main() {\n  gl_Position = vertex_main(PROJECTION_MATRIX, VIEW_MATRIX, MODEL_MATRIX);\n}\n`;\n\nconst VERTEX_SHADER_MULTI_ENTRY = `\n#ERROR Multiview rendering is not implemented\nvoid main() {\n  gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n}\n`;\n\nconst FRAGMENT_SHADER_ENTRY = `\nvoid main() {\n  gl_FragColor = fragment_main();\n}\n`;\n\nfunction isPowerOfTwo(n) {\n  return (n & (n - 1)) === 0;\n}\n\n// Creates a WebGL context and initializes it with some common default state.\nexport function createWebGLContext(glAttribs) {\n  glAttribs = glAttribs || { alpha: false };\n\n  let webglCanvas = document.createElement('canvas');\n  let contextTypes = glAttribs.webgl2 ? ['webgl2'] : ['webgl', 'experimental-webgl'];\n  let context = null;\n\n  for (let contextType of contextTypes) {\n    context = webglCanvas.getContext(contextType, glAttribs);\n    if (context)\n      break;\n  }\n\n  if (!context) {\n    let webglType = (glAttribs.webgl2 ? 'WebGL 2' : 'WebGL')\n    console.error('This browser does not support ' + webglType + '.');\n    return null;\n  }\n\n  return context;\n}\n\nexport class RenderView {\n  constructor(projection_matrix, view_matrix, viewport = null, eye = 'left') {\n    this.projection_matrix = projection_matrix;\n    this.view_matrix = view_matrix;\n    this.viewport = viewport;\n    // If an eye isn't given the left eye is assumed.\n    this._eye = eye;\n    this._eye_index = (eye == 'left' ? 0 : 1);\n  }\n\n  get eye() {\n    return this._eye;\n  }\n\n  set eye(value) {\n    this._eye = value;\n    this._eye_index = (value == 'left' ? 0 : 1);\n  }\n\n  get eye_index() {\n    return this._eye_index;\n  }\n}\n\nclass RenderBuffer {\n  constructor(target, usage, buffer, length = 0) {\n    this._target = target;\n    this._usage = usage;\n    this._length = length;\n    if (buffer instanceof Promise) {\n      this._buffer = null;\n      this._promise = buffer.then((buffer) => {\n        this._buffer = buffer;\n        return this;\n      });\n    } else {\n      this._buffer = buffer;\n      this._promise = Promise.resolve(this);\n    }\n  }\n\n  waitForComplete() {\n    return this._promise;\n  }\n}\n\nclass RenderPrimitiveAttribute {\n  constructor(primitive_attribute) {\n    this._attrib_index = ATTRIB[primitive_attribute.name];\n    this._component_count = primitive_attribute.component_count;\n    this._component_type = primitive_attribute.component_type;\n    this._stride = primitive_attribute.stride;\n    this._byte_offset = primitive_attribute.byte_offset;\n    this._normalized = primitive_attribute.normalized;\n  }\n}\n\nclass RenderPrimitiveAttributeBuffer {\n  constructor(buffer) {\n    this._buffer = buffer;\n    this._attributes = [];\n  }\n}\n\nclass RenderPrimitive {\n  constructor(primitive) {\n    this._instances = [];\n    this._material = null;\n\n    this.setPrimitive(primitive);\n  }\n\n  setPrimitive(primitive) {\n    this._mode = primitive.mode;\n    this._element_count = primitive.element_count;\n    this._promise = null;\n    this._vao = null;\n    this._complete = false;\n    this._attribute_buffers = [];\n    this._attribute_mask = 0;\n\n    for (let attribute of primitive.attributes) {\n      this._attribute_mask |= ATTRIB_MASK[attribute.name];\n      let render_attribute = new RenderPrimitiveAttribute(attribute);\n      let found_buffer = false;\n      for (let attribute_buffer of this._attribute_buffers) {\n        if (attribute_buffer._buffer == attribute.buffer) {\n          attribute_buffer._attributes.push(render_attribute);\n          found_buffer = true;\n          break;\n        }\n      }\n      if (!found_buffer) {\n        let attribute_buffer = new RenderPrimitiveAttributeBuffer(attribute.buffer);\n        attribute_buffer._attributes.push(render_attribute);\n        this._attribute_buffers.push(attribute_buffer);\n      }\n    }\n\n    this._index_buffer = null;\n    this._index_byte_offset = 0;\n    this._index_type = 0;\n\n    if (primitive.index_buffer) {\n      this._index_byte_offset = primitive.index_byte_offset;\n      this._index_type = primitive.index_type;\n      this._index_buffer = primitive.index_buffer;\n    }\n\n    if (primitive._min) {\n      this._min = vec3.clone(primitive._min);\n      this._max = vec3.clone(primitive._max);\n    } else {\n      this._min = null;\n      this._max = null;\n    }\n\n    if (this._material != null) {\n      this.waitForComplete(); // To flip the _complete flag.\n    }\n  }\n\n  setRenderMaterial(material) {\n    this._material = material;\n    this._promise = null;\n    this._complete = false;\n\n    if (this._material != null) {\n      this.waitForComplete(); // To flip the _complete flag.\n    }\n  }\n\n  markActive(frame_id) {\n    if (this._complete) {\n      this._active_frame_id = frame_id;\n\n      if (this.material) {\n        this.material.markActive(frame_id);\n      }\n\n      if (this.program) {\n        this.program.markActive(frame_id);\n      }\n    }\n  }\n\n  get samplers() {\n    return this._material._sampler_dictionary;\n  }\n\n  get uniforms() {\n    return this._material._uniform_dictionary;\n  }\n\n  waitForComplete() {\n    if (!this._promise) {\n      if (!this._material) {\n        return Promise.reject(\"RenderPrimitive does not have a material\");\n      }\n\n      let completion_promises = [];\n      completion_promises.push(this._material.waitForComplete());\n\n      for (let attribute_buffer of this._attribute_buffers) {\n        if (!attribute_buffer._buffer._buffer) {\n          completion_promises.push(attribute_buffer._buffer._promise);\n        }\n      }\n      \n      if (this._index_buffer && !this._index_buffer._buffer) {\n        completion_promises.push(this._index_buffer._promise);\n      }\n\n      this._promise = Promise.all(completion_promises).then(() => {\n        this._complete = true;\n        return this;\n      });\n    }\n    return this._promise;\n  }\n}\n\nconst inverse_matrix = mat4.create();\n\nfunction setCap(gl, gl_enum, cap, prev_state, state) {\n  let change = (state & cap) - (prev_state & cap);\n  if (!change)\n    return;\n\n  if (change > 0) {\n    gl.enable(gl_enum);\n  } else {\n    gl.disable(gl_enum);\n  }\n}\n\nclass RenderMaterialSampler {\n  constructor(renderer, material_sampler, index) {\n    this._renderer = renderer;\n    this._uniform_name = material_sampler._uniform_name;\n    this._texture = renderer._getRenderTexture(material_sampler._texture);\n    this._index = index;\n  }\n\n  set texture(value) {\n    this._texture = this._renderer._getRenderTexture(value);\n  }\n}\n\nclass RenderMaterialUniform {\n  constructor(material_uniform) {\n    this._uniform_name = material_uniform._uniform_name;\n    this._uniform = null;\n    this._length = material_uniform._length;\n    if (material_uniform._value instanceof Array) {\n      this._value = new Float32Array(material_uniform._value);\n    } else {\n      this._value = new Float32Array([material_uniform._value]);\n    }\n  }\n\n  set value(value) {\n    if (this._value.length == 1) {\n      this._value[0] = value;\n    } else {\n      for (let i = 0; i < this._value.length; ++i) {\n        this._value[i] = value[i];\n      }\n    }\n  }\n}\n\nclass RenderMaterial {\n  constructor(renderer, material, program) {\n    this._program = program;\n    this._state = material.state._state;\n\n    this._sampler_dictionary = {};\n    this._samplers = [];\n    for (let i = 0; i < material._samplers.length; ++i) {\n      let render_sampler = new RenderMaterialSampler(renderer, material._samplers[i], i);\n      this._samplers.push(render_sampler);\n      this._sampler_dictionary[render_sampler._uniform_name] = render_sampler;\n    }\n\n    this._uniform_dictionary = {};\n    this._uniforms = [];\n    for (let uniform of material._uniforms) {\n      let render_uniform = new RenderMaterialUniform(uniform);\n      this._uniforms.push(render_uniform);\n      this._uniform_dictionary[render_uniform._uniform_name] = render_uniform;\n    }\n\n    this._complete_promise = null;\n    this._first_bind = true;\n\n    this._render_order = material.render_order;\n    if (this._render_order == RENDER_ORDER.DEFAULT) {\n      if (this._state & CAP.BLEND) {\n        this._render_order = RENDER_ORDER.TRANSPARENT;\n      } else {\n        this._render_order = RENDER_ORDER.OPAQUE;\n      }\n    }\n  }\n\n  bind(gl) {\n    // First time we do a binding, cache the uniform locations and remove\n    // unused uniforms from the list.\n    if (this._first_bind) {\n      for (let i = 0; i < this._samplers.length;) {\n        let sampler = this._samplers[i];\n        if (!this._program.uniform[sampler._uniform_name]) {\n          this._samplers.splice(i, 1);\n          continue;\n        }\n        ++i;\n      }\n\n      for (let i = 0; i < this._uniforms.length;) {\n        let uniform = this._uniforms[i];\n        uniform._uniform = this._program.uniform[uniform._uniform_name];\n        if (!uniform._uniform) {\n          this._uniforms.splice(i, 1);\n          continue;\n        }\n        ++i;\n      }\n      this._first_bind = false;\n    }\n\n    for (let sampler of this._samplers) {\n      gl.activeTexture(gl.TEXTURE0 + sampler._index);\n      if (sampler._texture) {\n        //sampler._texture.bind(i);\n        gl.bindTexture(gl.TEXTURE_2D, sampler._texture);\n      } else {\n        gl.bindTexture(gl.TEXTURE_2D, null);\n      }\n    }\n\n    for (let uniform of this._uniforms) {\n      switch(uniform._length) {\n        case 1: gl.uniform1fv(uniform._uniform, uniform._value); break;\n        case 2: gl.uniform2fv(uniform._uniform, uniform._value); break;\n        case 3: gl.uniform3fv(uniform._uniform, uniform._value); break;\n        case 4: gl.uniform4fv(uniform._uniform, uniform._value); break;\n      }\n    }\n  }\n\n  waitForComplete() {\n    if (!this._complete_promise) {\n      if (this._samplers.length == 0) {\n        this._complete_promise = Promise.resolve(this);\n      } else {\n        let promises = [];\n        for (let sampler of this._samplers) {\n          if (sampler._texture && !sampler._texture._complete) {\n            promises.push(sampler._texture._promise);\n          }\n        }\n        this._complete_promise = Promise.all(promises).then(() => this);\n      }\n    }\n    return this._complete_promise;\n  }\n\n  // Material State fetchers\n  get cull_face() { return !!(this._state & CAP.CULL_FACE); }\n  get blend() { return !!(this._state & CAP.BLEND); }\n  get depth_test() { return !!(this._state & CAP.DEPTH_TEST); }\n  get stencil_test() { return !!(this._state & CAP.STENCIL_TEST); }\n  get color_mask() { return !!(this._state & CAP.COLOR_MASK); }\n  get depth_mask() { return !!(this._state & CAP.DEPTH_MASK); }\n  get stencil_mask() { return !!(this._state & CAP.STENCIL_MASK); }\n  get depth_func() { return ((this._state & MAT_STATE.DEPTH_FUNC_RANGE) >> MAT_STATE.DEPTH_FUNC_SHIFT) + WebGLRenderingContext.NEVER; }\n  get blend_func_src() { return stateToBlendFunc(this._state, MAT_STATE.BLEND_SRC_RANGE, MAT_STATE.BLEND_SRC_SHIFT); }\n  get blend_func_dst() { return stateToBlendFunc(this._state, MAT_STATE.BLEND_DST_RANGE, MAT_STATE.BLEND_DST_SHIFT); }\n\n  // Only really for use from the renderer\n  _capsDiff(other_state) {\n    return (other_state & MAT_STATE.CAPS_RANGE) ^ (this._state & MAT_STATE.CAPS_RANGE)\n  }\n\n  _blendDiff(other_state) {\n    if (!(this._state & CAP.BLEND))\n      return 0;\n    return (other_state & MAT_STATE.BLEND_FUNC_RANGE) ^ (this._state & MAT_STATE.BLEND_FUNC_RANGE);\n  }\n\n  _depthFuncDiff(other_state) {\n    if (!(this._state & CAP.DEPTH_TEST))\n      return 0;\n    return (other_state & MAT_STATE.DEPTH_FUNC_RANGE) ^ (this._state & MAT_STATE.DEPTH_FUNC_RANGE);\n  }\n}\n\nexport class Renderer {\n  constructor(gl) {\n    this._gl = gl || createWebGLContext();\n    this._frame_id = -1;\n    this._program_cache = {};\n    this._texture_cache = {};\n    this._render_primitives = Array(RENDER_ORDER.DEFAULT);\n    this._camera_positions = [];\n\n    this._vao_ext = gl.getExtension(\"OES_vertex_array_object\");\n\n    let frag_high_precision = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT);\n    this._default_frag_precision = frag_high_precision.precision > 0 ? 'highp' : 'mediump';\n\n    this._depth_mask_needs_reset = false;\n    this._color_mask_needs_reset = false;\n  }\n\n  get gl() {\n    return this._gl;\n  }\n\n  createRenderBuffer(target, data, usage = WebGLRenderingContext.STATIC_DRAW) {\n    let gl = this._gl;\n    let gl_buffer = gl.createBuffer();\n\n    if (data instanceof Promise) {\n      let render_buffer = new RenderBuffer(target, usage, data.then((data) => {\n        gl.bindBuffer(target, gl_buffer);\n        gl.bufferData(target, data, usage);\n        render_buffer._length = data.byteLength;\n        return gl_buffer;\n      }));\n      return render_buffer;\n    } else {\n      gl.bindBuffer(target, gl_buffer);\n      gl.bufferData(target, data, usage);\n      return new RenderBuffer(target, usage, gl_buffer, data.byteLength);\n    }\n  }\n\n  updateRenderBuffer(buffer, data, offset = 0) {\n    if (buffer._buffer) {\n      let gl = this._gl;\n      gl.bindBuffer(buffer._target, buffer._buffer);\n      if (offset == 0 && buffer._length == data.byteLength) {\n        gl.bufferData(buffer._target, data, buffer._usage);\n      } else {\n        gl.bufferSubData(buffer._target, offset, data);\n      }\n    } else {\n      buffer.waitForComplete().then((buffer) => {\n        this.updateRenderBuffer(buffer, data, offset);\n      });\n    }\n  }\n\n  createRenderPrimitive(primitive, material) {\n    let render_primitive = new RenderPrimitive(primitive);\n\n    let program = this._getMaterialProgram(material, render_primitive);\n    let render_material = new RenderMaterial(this, material, program);\n    render_primitive.setRenderMaterial(render_material);\n\n    if (!this._render_primitives[render_material._render_order]) {\n      this._render_primitives[render_material._render_order] = [];\n    }\n\n    this._render_primitives[render_material._render_order].push(render_primitive);\n\n    return render_primitive;\n  }\n\n  createMesh(primitive, material) {\n    let mesh_node = new Node();\n    mesh_node.addRenderPrimitive(this.createRenderPrimitive(primitive, material));\n    return mesh_node;\n  }\n\n  drawViews(views, root_node) {\n    if (!root_node) {\n      return;\n    }\n\n    let gl = this._gl;\n    this._frame_id++;\n\n    root_node.markActive(this._frame_id);\n\n    // If there's only one view then flip the algorithm a bit so that we're only\n    // setting the viewport once.\n    if (views.length == 1 && views[0].viewport) {\n      let vp = views[0].viewport;\n      this._gl.viewport(vp.x, vp.y, vp.width, vp.height);\n    }\n\n    // Get the positions of the 'camera' for each view matrix.\n    for (let i = 0; i < views.length; ++i) {\n      mat4.invert(inverse_matrix, views[i].view_matrix);\n\n      if (this._camera_positions.length <= i) {\n        this._camera_positions.push(vec3.create());\n      }\n      let camera_position = this._camera_positions[i];\n      vec3.set(camera_position, 0, 0, 0);\n      vec3.transformMat4(camera_position, camera_position, inverse_matrix);\n    }\n\n    // Draw each set of render primitives in order\n    for (let render_primitives of this._render_primitives) {\n      if (render_primitives && render_primitives.length) {\n        this._drawRenderPrimitiveSet(views, render_primitives);\n      }\n    }\n\n    if (this._vao_ext) {\n      this._vao_ext.bindVertexArrayOES(null);\n    }\n\n    if (this._depth_mask_needs_reset) {\n      gl.depthMask(true);\n    }\n    if (this._color_mask_needs_reset) {\n      gl.colorMask(true, true, true, true);\n    }\n    \n  }\n\n  _drawRenderPrimitiveSet(views, render_primitives) {\n    let gl = this._gl;\n    let program = null;\n    let material = null;\n    let attrib_mask = 0;\n\n    // Loop through every primitive known to the renderer.\n    for (let primitive of render_primitives) {\n      // Skip over those that haven't been marked as active for this frame.\n      if (primitive._active_frame_id != this._frame_id) {\n        continue;\n      }\n\n      // Bind the primitive material's program if it's different than the one we\n      // were using for the previous primitive.\n      // TODO: The ording of this could be more efficient.\n      if (program != primitive._material._program) {\n        program = primitive._material._program;\n        program.use();\n\n        if (program.uniform.LIGHT_DIRECTION)\n          gl.uniform3fv(program.uniform.LIGHT_DIRECTION, DEF_LIGHT_DIR);\n\n        if (program.uniform.LIGHT_COLOR)\n          gl.uniform3fv(program.uniform.LIGHT_COLOR, DEF_LIGHT_COLOR);\n\n        if (views.length == 1) {\n          gl.uniformMatrix4fv(program.uniform.PROJECTION_MATRIX, false, views[0].projection_matrix);\n          gl.uniformMatrix4fv(program.uniform.VIEW_MATRIX, false, views[0].view_matrix);\n          gl.uniform3fv(program.uniform.CAMERA_POSITION, this._camera_positions[0]);\n          gl.uniform1i(program.uniform.EYE_INDEX, views[0].eye_index);\n        }\n      }\n\n      if (material != primitive._material) {\n        this._bindMaterialState(primitive._material, material);\n        primitive._material.bind(gl, program, material);\n        material = primitive._material;\n      }\n\n      if (this._vao_ext) {\n        if (primitive._vao) {\n          this._vao_ext.bindVertexArrayOES(primitive._vao);\n        } else {\n          primitive._vao = this._vao_ext.createVertexArrayOES();\n          this._vao_ext.bindVertexArrayOES(primitive._vao);\n          this._bindPrimitive(primitive);\n        }\n      } else {\n        this._bindPrimitive(primitive, attrib_mask);\n        attrib_mask = primitive._attribute_mask;\n      }\n\n      for (let i = 0; i < views.length; ++i) {\n        let view = views[i];\n        if (views.length > 1) {\n          if (view.viewport) {\n            let vp = view.viewport;\n            gl.viewport(vp.x, vp.y, vp.width, vp.height);\n          }\n          gl.uniformMatrix4fv(program.uniform.PROJECTION_MATRIX, false, view.projection_matrix);\n          gl.uniformMatrix4fv(program.uniform.VIEW_MATRIX, false, view.view_matrix);\n          gl.uniform3fv(program.uniform.CAMERA_POSITION, this._camera_positions[i]);\n          gl.uniform1i(program.uniform.EYE_INDEX, view.eye_index);\n        }\n\n        for (let instance of primitive._instances) {\n          if (instance._active_frame_id != this._frame_id) {\n            continue;\n          }\n\n          gl.uniformMatrix4fv(program.uniform.MODEL_MATRIX, false, instance.world_matrix);\n\n          if (primitive._index_buffer) {\n            gl.drawElements(primitive._mode, primitive._element_count,\n                primitive._index_type, primitive._index_byte_offset);\n          } else {\n            gl.drawArrays(primitive._mode, 0, primitive._element_count);\n          }\n        }\n      }\n    }\n  }\n\n  _getRenderTexture(texture) {\n    if (!texture) {\n      return null;\n    }\n\n    let key = texture.texture_key;\n    if (!key) {\n      throw new Error(\"Texure does not have a valid key\");\n    }\n\n    if (key in this._texture_cache) {\n      return this._texture_cache[key];\n    } else {\n      let gl = this._gl;\n      let texture_handle = gl.createTexture();\n      this._texture_cache[key] = texture_handle;\n\n      if (texture instanceof DataTexture) {\n        gl.bindTexture(gl.TEXTURE_2D, texture_handle);\n        gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.width, texture.height, 0, texture.format, texture._type, texture._data);\n        this._setSamplerParameters(texture);\n      } else {\n        // Initialize the texture to black\n        gl.bindTexture(gl.TEXTURE_2D, texture_handle);\n        gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.width, texture.height, 0, texture.format, gl.UNSIGNED_BYTE, null);\n        this._setSamplerParameters(texture);\n\n        texture.waitForComplete().then(() => {\n          gl.bindTexture(gl.TEXTURE_2D, texture_handle);\n          gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.format, gl.UNSIGNED_BYTE, texture.source);\n          this._setSamplerParameters(texture);\n\n          if (texture instanceof VideoTexture) {\n            // \"Listen for updates\" to the video frames and copy to the texture.\n            function updateFrame() {\n              if (!texture._video.paused && !texture._video.waiting) {\n                gl.bindTexture(gl.TEXTURE_2D, texture_handle);\n                gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.format, gl.UNSIGNED_BYTE, texture.source);\n                window.setTimeout(updateFrame, 16); // TODO: UUUUUUUGGGGGGGHHHH!\n              }\n            }\n\n            texture._video.addEventListener('playing', updateFrame);\n          }\n        });\n      }\n\n      return texture_handle;\n    }\n  }\n\n  _setSamplerParameters(texture) {\n    let gl = this._gl;\n\n    let sampler = texture.sampler;\n    let power_of_two = isPowerOfTwo(texture.width) && isPowerOfTwo(texture.height);\n    let mipmap = power_of_two && texture.mipmap;\n    if (mipmap) {\n      gl.generateMipmap(gl.TEXTURE_2D);\n    }\n\n    let min_filter = sampler.min_filter || (mipmap ? gl.LINEAR_MIPMAP_LINEAR : gl.LINEAR);\n    let wrap_s = sampler.wrap_s || (power_of_two ? gl.REPEAT : gl.CLAMP_TO_EDGE);\n    let wrap_t = sampler.wrap_t || (power_of_two ? gl.REPEAT : gl.CLAMP_TO_EDGE);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, sampler.mag_filter || gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, min_filter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrap_s);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrap_t);\n  }\n\n  _getProgramKey(name, defines) {\n    let key = `${name}:`;\n\n    for (let define in defines) {\n      key += `${define}=${defines[define]},`;\n    }\n\n    return key;\n  }\n\n  _getMaterialProgram(material, render_primitive) {\n    let material_name = material.material_name;\n    let vertex_source = material.vertex_source;\n    let fragment_source = material.fragment_source;\n\n    // These should always be defined for every material\n    if (material_name == null) {\n      throw new Error(\"Material does not have a name\");\n    }\n    if (vertex_source == null) {\n      throw new Error(`Material \"${material_name}\" does not have a vertex source`);\n    }\n    if (fragment_source == null) {\n      throw new Error(`Material \"${material_name}\" does not have a fragment source`);\n    }\n\n    let defines = material.getProgramDefines(render_primitive);\n    let key = this._getProgramKey(material_name, defines);\n\n    if (key in this._program_cache) {\n      return this._program_cache[key];\n    } else {\n      let multiview = false; // Handle this dynamically later\n      let full_vertex_source = vertex_source;\n      full_vertex_source += multiview ? VERTEX_SHADER_MULTI_ENTRY :\n                                        VERTEX_SHADER_SINGLE_ENTRY;\n\n      let precision_match = fragment_source.match(PRECISION_REGEX);\n      let frag_precision_header = precision_match ? '' : `precision ${this._default_frag_precision} float;\\n`;\n\n      let full_fragment_source = frag_precision_header + fragment_source;\n      full_fragment_source += FRAGMENT_SHADER_ENTRY;\n\n      let program = new Program(this._gl, full_vertex_source, full_fragment_source, ATTRIB, defines);\n      this._program_cache[key] = program;\n\n      program.onNextUse((program) => {\n        // Bind the samplers to the right texture index. This is constant for\n        // the lifetime of the program.\n        for (let i = 0; i < material._samplers.length; ++i) {\n          let sampler = material._samplers[i];\n          let uniform = program.uniform[sampler._uniform_name];\n          if (uniform)\n            this._gl.uniform1i(uniform, i);\n        }\n      });\n\n      return program;\n    }\n  }\n\n  _bindPrimitive(primitive, attrib_mask) {\n    let gl = this._gl;\n\n    // If the active attributes have changed then update the active set.\n    if (attrib_mask != primitive._attribute_mask) {\n      for (let attrib in ATTRIB) {\n        if (primitive._attribute_mask & ATTRIB_MASK[attrib]) {\n          gl.enableVertexAttribArray(ATTRIB[attrib]);\n        } else {\n          gl.disableVertexAttribArray(ATTRIB[attrib]);\n        }\n      }\n    }\n\n    // Bind the primitive attributes and indices.\n    for (let attribute_buffer of primitive._attribute_buffers) {\n      gl.bindBuffer(gl.ARRAY_BUFFER, attribute_buffer._buffer._buffer);\n      for (let attrib of attribute_buffer._attributes) {\n        gl.vertexAttribPointer(\n            attrib._attrib_index, attrib._component_count, attrib._component_type,\n            attrib._normalized, attrib._stride, attrib._byte_offset);\n      }\n    }\n\n    if (primitive._index_buffer) {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, primitive._index_buffer._buffer);\n    } else {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    }\n  }\n\n  _bindMaterialState(material, prev_material = null) {\n    let gl = this._gl;\n\n    let state = material._state;\n    let prev_state = prev_material ? prev_material._state : ~state;\n\n    // Return early if both materials use identical state\n    if (state == prev_state)\n        return;\n\n    // Any caps bits changed?\n    if (material._capsDiff(prev_state)) {\n      setCap(gl, gl.CULL_FACE, CAP.CULL_FACE, prev_state, state);\n      setCap(gl, gl.BLEND, CAP.BLEND, prev_state, state);\n      setCap(gl, gl.DEPTH_TEST, CAP.DEPTH_TEST, prev_state, state);\n      setCap(gl, gl.STENCIL_TEST, CAP.STENCIL_TEST, prev_state, state);\n\n      let color_mask_change = (state & CAP.COLOR_MASK) - (prev_state & CAP.COLOR_MASK);\n      if (color_mask_change) {\n        let mask = color_mask_change > 1;\n        this._color_mask_needs_reset = !mask;\n        gl.colorMask(mask, mask, mask, mask);\n      }\n\n      let depth_mask_change = (state & CAP.DEPTH_MASK) - (prev_state & CAP.DEPTH_MASK);\n      if (depth_mask_change) {\n        this._depth_mask_needs_reset = !(depth_mask_change > 1);\n        gl.depthMask(depth_mask_change > 1);\n      }\n\n      let stencil_mask_change = (state & CAP.STENCIL_MASK) - (prev_state & CAP.STENCIL_MASK);\n      if (stencil_mask_change) {\n        gl.stencilMask(stencil_mask_change > 1);\n      }\n    }\n\n    // Blending enabled and blend func changed?\n    if (material._blendDiff(prev_state)) {\n      gl.blendFunc(material.blend_func_src, material.blend_func_dst);\n    }\n\n    // Depth testing enabled and depth func changed?\n    if (material._depthFuncDiff(prev_state)) {\n      gl.depthFunc(material.depth_func);\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/core/renderer.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nconst GL = WebGLRenderingContext; // For enums\n\nexport const CAP = {\n  // Enable caps\n  CULL_FACE:    0x001,\n  BLEND:        0x002,\n  DEPTH_TEST:   0x004,\n  STENCIL_TEST: 0x008,\n  COLOR_MASK:   0x010,\n  DEPTH_MASK:   0x020,\n  STENCIL_MASK: 0x040\n};\n\nexport const MAT_STATE = {\n  CAPS_RANGE:      0x000000FF,\n  BLEND_SRC_SHIFT:  8,\n  BLEND_SRC_RANGE:  0x00000F00,\n  BLEND_DST_SHIFT:  12,\n  BLEND_DST_RANGE:  0x0000F000,\n  BLEND_FUNC_RANGE: 0x0000FF00,\n  DEPTH_FUNC_SHIFT: 16,\n  DEPTH_FUNC_RANGE: 0x000F0000,\n};\n\nexport const RENDER_ORDER = {\n  // Render opaque objects first.\n  OPAQUE:      0,\n\n  // Render the sky after all opaque object to save fill rate.\n  SKY:         1,\n\n  // Render transparent objects next so that the opaqe objects show through.\n  TRANSPARENT: 2,\n\n  // Finally render purely additive effects like pointer rays so that they\n  // can render without depth mask.\n  ADDITIVE:    3,\n\n  // Render order will be picked based on the material properties.\n  DEFAULT:     4,\n};\n\nexport function stateToBlendFunc(state, mask, shift) {\n  let value = (state & mask) >> shift;\n  switch (value) {\n    case 0:\n    case 1:\n      return value;\n    default:\n      return (value - 2) + GL.SRC_COLOR;\n  }\n}\n\nexport class MaterialState {\n  constructor() {\n    this._state = CAP.CULL_FACE |\n                  CAP.DEPTH_TEST |\n                  CAP.COLOR_MASK |\n                  CAP.DEPTH_MASK;\n\n    // Use a fairly commonly desired blend func as the default.\n    this.blend_func_src = GL.SRC_ALPHA;\n    this.blend_func_dst = GL.ONE_MINUS_SRC_ALPHA;\n\n    this.depth_func = GL.LESS;\n  }\n\n  get cull_face() { return !!(this._state & CAP.CULL_FACE); }\n  set cull_face(value) {\n    if (value) {\n      this._state |= CAP.CULL_FACE;\n    } else {\n      this._state &= ~CAP.CULL_FACE;\n    }\n  }\n\n  get blend() { return !!(this._state & CAP.BLEND); }\n  set blend(value) {\n    if (value) {\n      this._state |= CAP.BLEND;\n    } else {\n      this._state &= ~CAP.BLEND;\n    }\n  }\n\n  get depth_test() { return !!(this._state & CAP.DEPTH_TEST); }\n  set depth_test(value) {\n    if (value) {\n      this._state |= CAP.DEPTH_TEST;\n    } else {\n      this._state &= ~CAP.DEPTH_TEST;\n    }\n  }\n\n  get stencil_test() { return !!(this._state & CAP.STENCIL_TEST); }\n  set stencil_test(value) {\n    if (value) {\n      this._state |= CAP.STENCIL_TEST;\n    } else {\n      this._state &= ~CAP.STENCIL_TEST;\n    }\n  }\n\n  get color_mask() { return !!(this._state & CAP.COLOR_MASK); }\n  set color_mask(value) {\n    if (value) {\n      this._state |= CAP.COLOR_MASK;\n    } else {\n      this._state &= ~CAP.COLOR_MASK;\n    }\n  }\n\n  get depth_mask() { return !!(this._state & CAP.DEPTH_MASK); }\n  set depth_mask(value) {\n    if (value) {\n      this._state |= CAP.DEPTH_MASK;\n    } else {\n      this._state &= ~CAP.DEPTH_MASK;\n    }\n  }\n\n  get depth_func() {\n    return ((this._state & MAT_STATE.DEPTH_FUNC_RANGE) >> MAT_STATE.DEPTH_FUNC_SHIFT) + WebGLRenderingContext.NEVER;\n  }\n  set depth_func(value) {\n    value = value - WebGLRenderingContext.NEVER;\n    this._state &= ~MAT_STATE.DEPTH_FUNC_RANGE;\n    this._state |= (value << MAT_STATE.DEPTH_FUNC_SHIFT)\n  }\n\n  get stencil_mask() { return !!(this._state & CAP.STENCIL_MASK); }\n  set stencil_mask(value) {\n    if (value) {\n      this._state |= CAP.STENCIL_MASK;\n    } else {\n      this._state &= ~CAP.STENCIL_MASK;\n    }\n  }\n\n  get blend_func_src() {\n    return stateToBlendFunc(this._state, MAT_STATE.BLEND_SRC_RANGE, MAT_STATE.BLEND_SRC_SHIFT);\n  }\n  set blend_func_src(value) {\n    switch(value) {\n      case 0:\n      case 1:\n        break;\n      default:\n        value = (value - WebGLRenderingContext.SRC_COLOR) + 2;\n    }\n    this._state &= ~MAT_STATE.BLEND_SRC_RANGE;\n    this._state |= (value << MAT_STATE.BLEND_SRC_SHIFT);\n  }\n\n  get blend_func_dst() {\n    return stateToBlendFunc(this._state, MAT_STATE.BLEND_DST_RANGE, MAT_STATE.BLEND_DST_SHIFT);\n  }\n  set blend_func_dst(value) {\n    switch(value) {\n      case 0:\n      case 1:\n        break;\n      default:\n        value = (value - WebGLRenderingContext.SRC_COLOR) + 2;\n    }\n    this._state &= ~MAT_STATE.BLEND_DST_RANGE;\n    this._state |= (value << MAT_STATE.BLEND_DST_SHIFT);\n  }\n}\n\nclass MaterialSampler {\n  constructor(uniform_name) {\n    this._uniform_name = uniform_name;\n    this._texture = null;\n  }\n\n  get texture() {\n    return this._texture;\n  }\n\n  set texture(value) {\n    this._texture = value;\n  }\n}\n\nclass MaterialUniform {\n  constructor(uniform_name, default_value, length) {\n    this._uniform_name = uniform_name;\n    this._value = default_value;\n    this._length = length;\n    if (!this._length) {\n      if (default_value instanceof Array) {\n        this._length = default_value.length;\n      } else {\n        this._length = 1;\n      }\n    }\n  }\n\n  get value() {\n    return this._value;\n  }\n\n  set value(value) {\n    this._value = value;\n  }\n}\n\nexport class Material {\n  constructor() {\n    this.state = new MaterialState;\n    this.render_order = RENDER_ORDER.DEFAULT;\n    this._samplers = [];\n    this._uniforms = [];\n  }\n\n  defineSampler(uniform_name) {\n    let sampler = new MaterialSampler(uniform_name);\n    this._samplers.push(sampler);\n    return sampler;\n  }\n\n  defineUniform(uniform_name, default_value=null, length=0) {\n    let uniform = new MaterialUniform(uniform_name, default_value, length);\n    this._uniforms.push(uniform);\n    return uniform;\n  }\n\n  get material_name() {\n    return null;\n  }\n\n  get vertex_source() {\n    return null;\n  }\n\n  get fragment_source() {\n    return null\n  }\n\n  getProgramDefines(render_primitive) {\n    return {};\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/material.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nexport class Program {\n  constructor(gl, vert_src, frag_src, attrib_map, defines) {\n    this._gl = gl;\n    this.program = gl.createProgram();\n    this.attrib = null;\n    this.uniform = null;\n    this.defines = {};\n\n    this._first_use = true;\n    this._next_use_callbacks = [];\n\n    let defines_string = '';\n    if (defines) {\n      for (let define in defines) {\n        this.defines[define] = defines[define];\n        defines_string += `#define ${define} ${defines[define]}\\n`;\n      }\n    }\n\n    this._vert_shader = gl.createShader(gl.VERTEX_SHADER);\n    gl.attachShader(this.program, this._vert_shader);\n    gl.shaderSource(this._vert_shader, defines_string + vert_src);\n    gl.compileShader(this._vert_shader);\n\n    this._frag_shader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.attachShader(this.program, this._frag_shader);\n    gl.shaderSource(this._frag_shader, defines_string + frag_src);\n    gl.compileShader(this._frag_shader);\n\n    if (attrib_map) {\n      this.attrib = {};\n      for (let attrib_name in attrib_map) {\n        gl.bindAttribLocation(this.program, attrib_map[attrib_name], attrib_name);\n        this.attrib[attrib_name] = attrib_map[attrib_name];\n      }\n    }\n\n    gl.linkProgram(this.program);\n  }\n\n  onNextUse(callback) {\n    this._next_use_callbacks.push(callback);\n  }\n\n  use() {\n    let gl = this._gl;\n\n    // If this is the first time the program has been used do all the error checking and\n    // attrib/uniform querying needed.\n    if (this._first_use) {\n      this._first_use = false;\n      if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n        if (!gl.getShaderParameter(this._vert_shader, gl.COMPILE_STATUS)) {\n          console.error('Vertex shader compile error: ' + gl.getShaderInfoLog(this._vert_shader));\n        } else if (!gl.getShaderParameter(this._frag_shader, gl.COMPILE_STATUS)) {\n          console.error('Fragment shader compile error: ' + gl.getShaderInfoLog(this._frag_shader));\n        } else {\n          console.error('Program link error: ' + gl.getProgramInfoLog(this.program));\n        }\n        gl.deleteProgram(this.program);\n        this.program = null;\n      } else {\n        if (!this.attrib) {\n          this.attrib = {};\n          let attrib_count = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\n          for (let i = 0; i < attrib_count; i++) {\n            let attrib_info = gl.getActiveAttrib(this.program, i);\n            this.attrib[attrib_info.name] = gl.getAttribLocation(this.program, attrib_info.name);\n          }\n        }\n\n        this.uniform = {};\n        let uniform_count = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\n        let uniform_name = '';\n        for (let i = 0; i < uniform_count; i++) {\n          let uniform_info = gl.getActiveUniform(this.program, i);\n          uniform_name = uniform_info.name.replace('[0]', '');\n          this.uniform[uniform_name] = gl.getUniformLocation(this.program, uniform_name);\n        }\n      }\n      gl.deleteShader(this._vert_shader);\n      gl.deleteShader(this._frag_shader);\n    }\n\n    gl.useProgram(this.program);\n\n    if (this._next_use_callbacks.length) {\n      for (let callback of this._next_use_callbacks) {\n        callback(this);\n      }\n      this._next_use_callbacks = [];\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/core/program.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nconst GL = WebGLRenderingContext; // For enums\n\nexport class TextureSampler {\n  constructor() {\n    this.min_filter = null;\n    this.mag_filter = null;\n    this.wrap_s = null;\n    this.wrap_t = null;\n  }\n}\n\nexport class Texture {\n  constructor() {\n    this.sampler = new TextureSampler();\n    this.mipmap = true;\n    //TODO: Anisotropy\n  }\n\n  get format() {\n    return GL.RGBA\n  }\n\n  get width() {\n    return 0;\n  }\n\n  get height() {\n    return 0;\n  }\n\n  get texture_key() {\n    return null;\n  }\n}\n\nexport class ImageTexture extends Texture {\n  constructor(img) {\n    super();\n\n    this._img = img;\n\n    if (img.src && img.complete) {\n      if (img.naturalWidth) {\n        this._promise = Promise.resolve(this);\n      } else {\n        this._promise = Promise.reject(\"Image provided had failed to load.\");\n      }\n    } else {\n      this._promise = new Promise((resolve, reject) => {\n        img.addEventListener('load', () => resolve(this));\n        img.addEventListener('error', reject);\n      });\n    }\n  }\n\n  get format() {\n    // TODO: Can be RGB in some cases.\n    return GL.RGBA;\n  }\n\n  get width() {\n    return this._img.width;\n  }\n\n  get height() {\n    return this._img.height;\n  }\n\n  waitForComplete() {\n    return this._promise;\n  }\n\n  get texture_key() {\n    return this._img.src;\n  }\n\n  get source() {\n    return this._img;\n  }\n}\n\nexport class UrlTexture extends ImageTexture {\n  constructor(url) {\n    let img = new Image();\n    super(img);\n    img.src = url;\n  }\n}\n\nexport class BlobTexture extends ImageTexture {\n  constructor(blob) {\n    let img = new Image();\n    super(img);\n    img.src = window.URL.createObjectURL(blob);\n  }\n}\n\nexport class VideoTexture extends Texture {\n  constructor(video) {\n    super();\n\n    this._video = video;\n\n    if (video.readyState >= 2) {\n      this._promise = Promise.resolve(this);\n    } else if (video.error) {\n      this._promise = Promise.reject(video.error);\n    } else {\n      this._promise = new Promise((resolve, reject) => {\n        video.addEventListener('loadeddata', () => resolve(this));\n        video.addEventListener('error', reject);\n      });\n    }\n  }\n\n  get format() {\n    // TODO: Can be RGB in some cases.\n    return GL.RGBA;\n  }\n\n  get width() {\n    return this._video.videoWidth;\n  }\n\n  get height() {\n    return this._video.videoHeight;\n  }\n\n  waitForComplete() {\n    return this._promise;\n  }\n\n  get texture_key() {\n    return this._video.src;\n  }\n\n  get source() {\n    return this._video;\n  }\n}\n\nlet next_data_texture_index = 0;\n\nexport class DataTexture extends Texture {\n  constructor(data, width, height, format = GL.RGBA, type = GL.UNSIGNED_BYTE) {\n    super();\n\n    this._data = data;\n    this._width = width;\n    this._height = height;\n    this._format = format;\n    this._type = type;\n    this._key = `DATA_${next_data_texture_index}`;\n    next_data_texture_index++;\n  }\n\n  get format() {\n    return this._format;\n  }\n\n  get width() {\n    return this._width;\n  }\n\n  get height() {\n    return this._height;\n  }\n\n  get texture_key() {\n    return this._key;\n  }\n}\n\nexport class ColorTexture extends DataTexture {\n  constructor(r, g, b, a) {\n    let color_data = new Uint8Array([r*255.0, g*255.0, b*255.0, a*255.0]);\n    super(color_data, 1, 1);\n\n    this.mipmap = false;\n    this._key = `COLOR_${color_data[0]}_${color_data[1]}_${color_data[2]}_${color_data[3]}`;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/texture.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { Primitive, PrimitiveAttribute } from '../core/primitive.js'\n\nconst GL = WebGLRenderingContext; // For enums\n\nconst temp_vec3 = vec3.create();\n\nexport class PrimitiveStream {\n  constructor(options) {\n    this._vertices = [];\n    this._indices = [];\n\n    this._geometry_started = false;\n\n    this._vertex_offset = 0;\n    this._vertex_index = 0;\n    this._high_index = 0;\n\n    this._flip_winding = false;\n    this._invert_normals = false;\n    this._transform = null;\n    this._normal_transform = null;\n    this._min = null;\n    this._max = null;\n  }\n\n  set flip_winding(value) {\n    if (this._geometry_started) {\n      throw new Error(`Cannot change flip_winding before ending the current geometry.`);\n    }\n    this._flip_winding = value;\n  }\n\n  get flip_winding() {\n    this._flip_winding;\n  }\n\n  set invert_normals(value) {\n    if (this._geometry_started) {\n      throw new Error(`Cannot change invert_normals before ending the current geometry.`);\n    }\n    this._invert_normals = value;\n  }\n\n  get invert_normals() {\n    this._invert_normals;\n  }\n\n  set transform(value) {\n    if (this._geometry_started) {\n      throw new Error(`Cannot change transform before ending the current geometry.`);\n    }\n    this._transform = value;\n    if (this._transform) {\n      if (!this._normal_transform) {\n        this._normal_transform = mat3.create();\n      }\n      mat3.fromMat4(this._normal_transform, this._transform);\n    }\n  }\n\n  get transform() {\n    this._transform;\n  }\n\n  startGeometry() {\n    if (this._geometry_started) {\n      throw new Error(`Attempted to start a new geometry before the previous one was ended.`);\n    }\n\n    this._geometry_started = true;\n    this._vertex_index = 0;\n    this._high_index = 0;\n  }\n\n  endGeometry() {\n    if (!this._geometry_started) {\n      throw new Error(`Attempted to end a geometry before one was started.`);\n    }\n\n    if (this._high_index >= this._vertex_index) {\n      throw new Error(`Geometry contains indices that are out of bounds. (Contains an index of ${this._high_index} when the vertex count is ${this._vertex_index})`);\n    }\n\n    this._geometry_started = false;\n    this._vertex_offset += this._vertex_index;\n\n    // TODO: Anything else need to be done to finish processing here?\n  }\n\n  pushVertex(x, y, z, u, v, nx, ny, nz) {\n    if (!this._geometry_started) {\n      throw new Error(`Cannot push vertices before calling startGeometry().`);\n    }\n\n    // Transform the incoming vertex if we have a transformation matrix\n    if (this._transform) {\n      temp_vec3[0] = x;\n      temp_vec3[1] = y;\n      temp_vec3[2] = z;\n      vec3.transformMat4(temp_vec3, temp_vec3, this._transform);\n      x = temp_vec3[0];\n      y = temp_vec3[1];\n      z = temp_vec3[2];\n\n      temp_vec3[0] = nx;\n      temp_vec3[1] = ny;\n      temp_vec3[2] = nz;\n      vec3.transformMat3(temp_vec3, temp_vec3, this._normal_transform);\n      nx = temp_vec3[0];\n      ny = temp_vec3[1];\n      nz = temp_vec3[2];\n    }\n\n    if (this._invert_normals) {\n      nx *= -1.0;\n      ny *= -1.0;\n      nz *= -1.0;\n    }\n\n    this._vertices.push(x, y, z, u, v, nx, ny, nz);\n\n    if (this._min) {\n      this._min[0] = Math.min(this._min[0], x);\n      this._min[1] = Math.min(this._min[1], y);\n      this._min[2] = Math.min(this._min[2], z);\n      this._max[0] = Math.max(this._max[0], x);\n      this._max[1] = Math.max(this._max[1], y);\n      this._max[2] = Math.max(this._max[2], z);\n    } else {\n      this._min = vec3.fromValues(x, y, z);\n      this._max = vec3.fromValues(x, y, z);\n    }\n\n    return this._vertex_index++;\n  }\n\n  get next_vertex_index() {\n    return this._vertex_index;\n  }\n\n  pushTriangle(idx_a, idx_b, idx_c) {\n    if (!this._geometry_started) {\n      throw new Error(`Cannot push triangles before calling startGeometry().`);\n    }\n\n    this._high_index = Math.max(this._high_index, idx_a, idx_b, idx_c);\n\n    idx_a += this._vertex_offset;\n    idx_b += this._vertex_offset;\n    idx_c += this._vertex_offset;\n\n    if (this._flip_winding) {\n      this._indices.push(idx_c, idx_b, idx_a);\n    } else {\n      this._indices.push(idx_a, idx_b, idx_c);\n    }\n  }\n\n  clear() {\n    if (this._geometry_started) {\n      throw new Error(`Cannot clear before ending the current geometry.`);\n    }\n\n    this._vertices = [];\n    this._indices = [];\n    this._vertex_offset = 0;\n    this._min = null;\n    this._max = null;\n  }\n\n  finishPrimitive(renderer) {\n    if (!this._vertex_offset) {\n      throw new Error(`Attempted to call finishPrimitive() before creating any geometry.`);\n    }\n\n    let vertex_buffer = renderer.createRenderBuffer(GL.ARRAY_BUFFER, new Float32Array(this._vertices));\n    let index_buffer = renderer.createRenderBuffer(GL.ELEMENT_ARRAY_BUFFER, new Uint16Array(this._indices));\n\n    let attribs = [\n      new PrimitiveAttribute(\"POSITION\", vertex_buffer, 3, GL.FLOAT, 32, 0),\n      new PrimitiveAttribute(\"TEXCOORD_0\", vertex_buffer, 2, GL.FLOAT, 32, 12),\n      new PrimitiveAttribute(\"NORMAL\", vertex_buffer, 3, GL.FLOAT, 32, 20),\n    ];\n  \n    let primitive = new Primitive(attribs, this._indices.length);\n    primitive.setIndexBuffer(index_buffer);\n    primitive.setBounds(this._min, this._max);\n\n    return primitive;\n  }\n}\n\nexport class GeometryBuilderBase {\n  constructor(primitive_stream) {\n    if (primitive_stream) {\n      this._stream = primitive_stream;\n    } else {\n      this._stream = new PrimitiveStream();\n    }\n  }\n\n  set primitive_stream(value) {\n    this._stream = value;\n  }\n\n  get primitive_stream() {\n    return this._stream;\n  }\n\n  finishPrimitive(renderer) {\n    return this._stream.finishPrimitive(renderer);\n  }\n\n  clear() {\n    this._stream.clear();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/geometry/primitive-stream.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nexport class PrimitiveAttribute {\n  constructor(name, buffer, component_count, component_type, stride, byte_offset) {\n    this.name = name;\n    this.buffer = buffer;\n    this.component_count = component_count || 3;\n    this.component_type = component_type || 5126; // gl.FLOAT;\n    this.stride = stride || 0;\n    this.byte_offset = byte_offset || 0;\n    this.normalized = false;\n  }\n}\n\nexport class Primitive {\n  constructor(attributes, element_count, mode) {\n    this.attributes = attributes || [];\n    this.element_count = element_count || 0;\n    this.mode = mode || 4; // gl.TRIANGLES;\n    this.index_buffer = null;\n    this.index_byte_offset = 0;\n    this.index_type = 0;\n    this._min = null;\n    this._max = null;\n  }\n\n  setIndexBuffer(index_buffer, byte_offset, index_type) {\n    this.index_buffer = index_buffer;\n    this.index_byte_offset = byte_offset || 0;\n    this.index_type = index_type || 5123; // gl.UNSIGNED_SHORT;\n  }\n\n  setBounds(min, max) {\n    this._min = vec3.clone(min);\n    this._max = vec3.clone(max);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/core/primitive.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { PrimitiveStream, GeometryBuilderBase } from './primitive-stream.js'\n\nexport class BoxBuilder extends GeometryBuilderBase {\n  pushBox(min, max) {\n    let stream = this.primitive_stream;\n\n    let w = max[0] - min[0];\n    let h = max[1] - min[1];\n    let d = max[2] - min[2];\n\n    let wh = w * 0.5;\n    let hh = h * 0.5;\n    let dh = d * 0.5;\n\n    let cx = min[0] + wh;\n    let cy = min[1] + hh;\n    let cz = min[2] + dh;\n\n    stream.startGeometry();\n\n    // Bottom\n    let idx = stream.next_vertex_index;\n    stream.pushTriangle(idx, idx+1, idx+2);\n    stream.pushTriangle(idx, idx+2, idx+3);\n\n    //                 X       Y       Z       U    V     NX    NY   NZ \n    stream.pushVertex(-wh+cx, -hh+cy, -dh+cz,  0.0, 1.0,  0.0, -1.0, 0.0);\n    stream.pushVertex(+wh+cx, -hh+cy, -dh+cz,  1.0, 1.0,  0.0, -1.0, 0.0);\n    stream.pushVertex(+wh+cx, -hh+cy, +dh+cz,  1.0, 0.0,  0.0, -1.0, 0.0);\n    stream.pushVertex(-wh+cx, -hh+cy, +dh+cz,  0.0, 0.0,  0.0, -1.0, 0.0);\n\n    // Top\n    idx = stream.next_vertex_index;\n    stream.pushTriangle(idx, idx+2, idx+1);\n    stream.pushTriangle(idx, idx+3, idx+2);\n\n    stream.pushVertex(-wh+cx, +hh+cy, -dh+cz,  0.0, 0.0,  0.0, 1.0, 0.0);\n    stream.pushVertex(+wh+cx, +hh+cy, -dh+cz,  1.0, 0.0,  0.0, 1.0, 0.0);\n    stream.pushVertex(+wh+cx, +hh+cy, +dh+cz,  1.0, 1.0,  0.0, 1.0, 0.0);\n    stream.pushVertex(-wh+cx, +hh+cy, +dh+cz,  0.0, 1.0,  0.0, 1.0, 0.0);\n\n    // Left\n    idx = stream.next_vertex_index;\n    stream.pushTriangle(idx, idx+2, idx+1);\n    stream.pushTriangle(idx, idx+3, idx+2);\n\n    stream.pushVertex(-wh+cx, -hh+cy, -dh+cz,  0.0, 1.0,  -1.0, 0.0, 0.0);\n    stream.pushVertex(-wh+cx, +hh+cy, -dh+cz,  0.0, 0.0,  -1.0, 0.0, 0.0);\n    stream.pushVertex(-wh+cx, +hh+cy, +dh+cz,  1.0, 0.0,  -1.0, 0.0, 0.0);\n    stream.pushVertex(-wh+cx, -hh+cy, +dh+cz,  1.0, 1.0,  -1.0, 0.0, 0.0);\n\n    // Right\n    idx = stream.next_vertex_index;\n    stream.pushTriangle(idx, idx+1, idx+2);\n    stream.pushTriangle(idx, idx+2, idx+3);\n\n    stream.pushVertex(+wh+cx, -hh+cy, -dh+cz,  1.0, 1.0,  1.0, 0.0, 0.0);\n    stream.pushVertex(+wh+cx, +hh+cy, -dh+cz,  1.0, 0.0,  1.0, 0.0, 0.0);\n    stream.pushVertex(+wh+cx, +hh+cy, +dh+cz,  0.0, 0.0,  1.0, 0.0, 0.0);\n    stream.pushVertex(+wh+cx, -hh+cy, +dh+cz,  0.0, 1.0,  1.0, 0.0, 0.0);\n\n    // Back\n    idx = stream.next_vertex_index;\n    stream.pushTriangle(idx, idx+2, idx+1);\n    stream.pushTriangle(idx, idx+3, idx+2);\n\n    stream.pushVertex(-wh+cx, -hh+cy, -dh+cz,  1.0, 1.0,  0.0, 0.0, -1.0);\n    stream.pushVertex(+wh+cx, -hh+cy, -dh+cz,  0.0, 1.0,  0.0, 0.0, -1.0);\n    stream.pushVertex(+wh+cx, +hh+cy, -dh+cz,  0.0, 0.0,  0.0, 0.0, -1.0);\n    stream.pushVertex(-wh+cx, +hh+cy, -dh+cz,  1.0, 0.0,  0.0, 0.0, -1.0);\n\n    // Front\n    idx = stream.next_vertex_index;\n    stream.pushTriangle(idx, idx+1, idx+2);\n    stream.pushTriangle(idx, idx+2, idx+3);\n\n    stream.pushVertex(-wh+cx, -hh+cy, +dh+cz,  0.0, 1.0,  0.0, 0.0, 1.0);\n    stream.pushVertex(+wh+cx, -hh+cy, +dh+cz,  1.0, 1.0,  0.0, 0.0, 1.0);\n    stream.pushVertex(+wh+cx, +hh+cy, +dh+cz,  1.0, 0.0,  0.0, 0.0, 1.0);\n    stream.pushVertex(-wh+cx, +hh+cy, +dh+cz,  0.0, 0.0,  0.0, 0.0, 1.0);\n\n    stream.endGeometry();\n  }\n\n  pushCube(center = [0, 0, 0], size = 1.0) {\n    let hs = size * 0.5;\n    this.pushBox([center[0] - hs, center[1] - hs, center[2] - hs],\n                 [center[0] + hs, center[1] + hs, center[2] + hs]);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/geometry/box-builder.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { Material } from '../core/material.js'\nimport { ATTRIB_MASK } from '../core/renderer.js'\n\nconst VERTEX_SOURCE = `\nattribute vec3 POSITION, NORMAL;\nattribute vec2 TEXCOORD_0, TEXCOORD_1;\n\nuniform vec3 CAMERA_POSITION;\nuniform vec3 LIGHT_DIRECTION;\n\nvarying vec3 vLight; // Vector from vertex to light.\nvarying vec3 vView; // Vector from vertex to camera.\nvarying vec2 vTex;\n\n#ifdef USE_NORMAL_MAP\nattribute vec4 TANGENT;\nvarying mat3 vTBN;\n#else\nvarying vec3 vNorm;\n#endif\n\n#ifdef USE_VERTEX_COLOR\nattribute vec4 COLOR_0;\nvarying vec4 vCol;\n#endif\n\nvec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n  vec3 n = normalize(vec3(model * vec4(NORMAL, 0.0)));\n#ifdef USE_NORMAL_MAP\n  vec3 t = normalize(vec3(model * vec4(TANGENT.xyz, 0.0)));\n  vec3 b = cross(n, t) * TANGENT.w;\n  vTBN = mat3(t, b, n);\n#else\n  vNorm = n;\n#endif\n\n#ifdef USE_VERTEX_COLOR\n  vCol = COLOR_0;\n#endif\n\n  vTex = TEXCOORD_0;\n  vec4 mPos = model * vec4(POSITION, 1.0);\n  vLight = -LIGHT_DIRECTION;\n  vView = CAMERA_POSITION - mPos.xyz;\n  return proj * view * mPos;\n}`;\n\n// These equations are borrowed with love from this docs from Epic because I\n// just don't have anything novel to bring to the PBR scene.\n// http://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf\nconst EPIC_PBR_FUNCTIONS = `\nvec3 lambertDiffuse(vec3 cDiff) {\n  return cDiff / M_PI;\n}\n\nfloat specD(float a, float nDotH) {\n  float aSqr = a * a;\n  float f = ((nDotH * nDotH) * (aSqr - 1.0) + 1.0);\n  return aSqr / (M_PI * f * f);\n}\n\nfloat specG(float roughness, float nDotL, float nDotV) {\n  float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n  float gl = nDotL / (nDotL * (1.0 - k) + k);\n  float gv = nDotV / (nDotV * (1.0 - k) + k);\n  return gl * gv;\n}\n\nvec3 specF(float vDotH, vec3 F0) {\n  float exponent = (-5.55473 * vDotH - 6.98316) * vDotH;\n  float base = 2.0;\n  return F0 + (1.0 - F0) * pow(base, exponent);\n}`;\n\nconst FRAGMENT_SOURCE = `\n#define M_PI 3.14159265\n\nuniform vec4 baseColorFactor;\n#ifdef USE_BASE_COLOR_MAP\nuniform sampler2D baseColorTex;\n#endif\n\nvarying vec3 vLight;\nvarying vec3 vView;\nvarying vec2 vTex;\n\n#ifdef USE_VERTEX_COLOR\nvarying vec4 vCol;\n#endif\n\n#ifdef USE_NORMAL_MAP\nuniform sampler2D normalTex;\nvarying mat3 vTBN;\n#else\nvarying vec3 vNorm;\n#endif\n\n#ifdef USE_METAL_ROUGH_MAP\nuniform sampler2D metallicRoughnessTex;\n#endif\nuniform vec2 metallicRoughnessFactor;\n\n#ifdef USE_OCCLUSION\nuniform sampler2D occlusionTex;\nuniform float occlusionStrength;\n#endif\n\n#ifdef USE_EMISSIVE_TEXTURE\nuniform sampler2D emissiveTex;\n#endif\nuniform vec3 emissiveFactor;\n\nuniform vec3 LIGHT_COLOR;\n\nconst vec3 dielectricSpec = vec3(0.04);\nconst vec3 black = vec3(0.0);\n\n${EPIC_PBR_FUNCTIONS}\n\nvec4 fragment_main() {\n#ifdef USE_BASE_COLOR_MAP\n  vec4 baseColor = texture2D(baseColorTex, vTex) * baseColorFactor;\n#else\n  vec4 baseColor = baseColorFactor;\n#endif\n\n#ifdef USE_VERTEX_COLOR\n  baseColor *= vCol;\n#endif\n\n#ifdef USE_NORMAL_MAP\n  vec3 n = texture2D(normalTex, vTex).rgb;\n  n = normalize(vTBN * (2.0 * n - 1.0));\n#else\n  vec3 n = normalize(vNorm);\n#endif\n\n#ifdef FULLY_ROUGH\n  float metallic = 0.0;\n#else\n  float metallic = metallicRoughnessFactor.x;\n#endif\n\n  float roughness = metallicRoughnessFactor.y;\n\n#ifdef USE_METAL_ROUGH_MAP\n  vec4 metallicRoughness = texture2D(metallicRoughnessTex, vTex);\n  metallic *= metallicRoughness.b;\n  roughness *= metallicRoughness.g;\n#endif\n  \n  vec3 l = normalize(vLight);\n  vec3 v = normalize(vView);\n  vec3 h = normalize(l+v);\n\n  float nDotL = clamp(dot(n, l), 0.001, 1.0);\n  float nDotV = abs(dot(n, v)) + 0.001;\n  float nDotH = max(dot(n, h), 0.0);\n  float vDotH = max(dot(v, h), 0.0);\n\n  // From GLTF Spec\n  vec3 cDiff = mix(baseColor.rgb * (1.0 - dielectricSpec.r), black, metallic); // Diffuse color\n  vec3 F0 = mix(dielectricSpec, baseColor.rgb, metallic); // Specular color\n  float a = roughness * roughness;\n\n#ifdef FULLY_ROUGH\n  vec3 specular = F0 * 0.45;\n#else\n  vec3 F = specF(vDotH, F0);\n  float D = specD(a, nDotH);\n  float G = specG(roughness, nDotL, nDotV);\n  vec3 specular = (D * F * G) / (4.0 * nDotL * nDotV);\n#endif\n  float halfLambert = dot(n, l) * 0.5 + 0.5;\n  halfLambert *= halfLambert;\n\n  vec3 color = (halfLambert * LIGHT_COLOR * lambertDiffuse(cDiff)) + specular;\n\n#ifdef USE_OCCLUSION\n  float occlusion = texture2D(occlusionTex, vTex).r;\n  color = mix(color, color * occlusion, occlusionStrength);\n#endif\n  \n  vec3 emissive = emissiveFactor;\n#ifdef USE_EMISSIVE_TEXTURE\n  emissive *= texture2D(emissiveTex, vTex).rgb;\n#endif\n  color += emissive;\n\n  // gamma correction\n  color = pow(color, vec3(1.0/2.2));\n\n  return vec4(color, baseColor.a);\n}`;\n\nexport class PbrMaterial extends Material {\n  constructor() {\n    super();\n\n    this.base_color = this.defineSampler(\"baseColorTex\");\n    this.metallic_roughness = this.defineSampler(\"metallicRoughnessTex\");\n    this.normal = this.defineSampler(\"normalTex\");\n    this.occlusion = this.defineSampler(\"occlusionTex\");\n    this.emissive = this.defineSampler(\"emissiveTex\");\n\n    this.base_color_factor = this.defineUniform(\"baseColorFactor\", [1.0, 1.0, 1.0, 1.0]);\n    this.metallic_roughness_factor = this.defineUniform(\"metallicRoughnessFactor\", [1.0, 1.0]);\n    this.occlusion_strength = this.defineUniform(\"occlusionStrength\", 1.0);\n    this.emissive_factor = this.defineUniform(\"emissiveFactor\", [0, 0, 0]);\n  }\n\n  get material_name() {\n    return 'PBR';\n  }\n\n  get vertex_source() {\n    return VERTEX_SOURCE;\n  }\n\n  get fragment_source() {\n    return FRAGMENT_SOURCE;\n  }\n\n  getProgramDefines(render_primitive) {\n    let program_defines = {};\n\n    if (render_primitive._attribute_mask & ATTRIB_MASK.COLOR_0) {\n      program_defines['USE_VERTEX_COLOR'] = 1;\n    }\n\n    if (render_primitive._attribute_mask & ATTRIB_MASK.TEXCOORD_0) {\n      if(this.base_color.texture) {\n        program_defines['USE_BASE_COLOR_MAP'] = 1;\n      }\n\n      if(this.normal.texture && (render_primitive._attribute_mask & ATTRIB_MASK.TANGENT)) {\n        program_defines['USE_NORMAL_MAP'] = 1;\n      }\n\n      if(this.metallic_roughness.texture) {\n        program_defines['USE_METAL_ROUGH_MAP'] = 1;\n      }\n\n      if(this.occlusion.texture) {\n        program_defines['USE_OCCLUSION'] = 1;\n      }\n\n      if(this.emissive.texture) {\n        program_defines['USE_EMISSIVE_TEXTURE'] = 1;\n      }\n    }\n\n    if ((!this.metallic_roughness.texture ||\n         !(render_primitive._attribute_mask & ATTRIB_MASK.TEXCOORD_0)) &&\n        this.metallic_roughness_factor.value[1] == 1.0) {\n      program_defines['FULLY_ROUGH'] = 1;\n    }\n\n    return program_defines;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/materials/pbr.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { Material } from '../core/material.js'\nimport { Node } from '../core/node.js'\nimport { PrimitiveStream } from '../geometry/primitive-stream.js'\n\nconst GL = WebGLRenderingContext; // For enums\nconst BUTTON_SIZE = 0.1;\nconst BUTTON_CORNER_RADIUS = 0.025;\nconst BUTTON_CORNER_SEGMENTS = 8;\nconst BUTTON_ICON_SIZE = 0.07;\nconst BUTTON_LAYER_DISTANCE = 0.005;\nconst BUTTON_COLOR = 0.75;\nconst BUTTON_ALPHA = 0.85;\nconst BUTTON_HOVER_COLOR = 0.9;\nconst BUTTON_HOVER_ALPHA = 1.0;\nconst BUTTON_HOVER_SCALE = 1.1;\nconst BUTTON_HOVER_TRANSITION_TIME_MS = 200;\n\nclass ButtonMaterial extends Material {\n  constructor() {\n    super();\n\n    this.state.blend = true;\n    //this.state.blend_func_src = GL.SRC_ALPHA;\n    //this.state.blend_func_dst = GL.ONE;\n\n    this.defineUniform(\"hoverAmount\", 0);\n  }\n\n  get material_name() {\n    return 'BUTTON_MATERIAL';\n  }\n\n  get vertex_source() {\n    return `\n    attribute vec3 POSITION;\n\n    uniform float hoverAmount;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      float scale = mix(1.0, ${BUTTON_HOVER_SCALE}, hoverAmount);\n      vec4 pos = vec4(POSITION.x * scale, POSITION.y * scale, POSITION.z * (scale + (hoverAmount * 0.2)), 1.0);\n      return proj * view * model * pos;\n    }`;\n  }\n\n  get fragment_source() {\n    return `\n    uniform float hoverAmount;\n\n    const vec4 default_color = vec4(${BUTTON_COLOR}, ${BUTTON_COLOR}, ${BUTTON_COLOR}, ${BUTTON_ALPHA});\n    const vec4 hover_color = vec4(${BUTTON_HOVER_COLOR}, ${BUTTON_HOVER_COLOR}, ${BUTTON_HOVER_COLOR}, ${BUTTON_HOVER_ALPHA});\n\n    vec4 fragment_main() {\n      return mix(default_color, hover_color, hoverAmount);\n    }`;\n  }\n}\n\nclass ButtonIconMaterial extends Material {\n  constructor() {\n    super();\n\n    this.state.blend = true;\n\n    this.defineUniform(\"hoverAmount\", 0);\n    this.icon = this.defineSampler(\"icon\");\n  }\n\n  get material_name() {\n    return 'BUTTON_ICON_MATERIAL';\n  }\n\n  get vertex_source() {\n    return `\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n\n    uniform float hoverAmount;\n\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vTexCoord = TEXCOORD_0;\n      float scale = mix(1.0, ${BUTTON_HOVER_SCALE}, hoverAmount);\n      vec4 pos = vec4(POSITION.x * scale, POSITION.y * scale, POSITION.z * (scale + (hoverAmount * 0.2)), 1.0);\n      return proj * view * model * pos;\n    }`;\n  }\n\n  get fragment_source() {\n    return `\n    uniform sampler2D icon;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(icon, vTexCoord);\n    }`;\n  }\n}\n\nexport class ButtonNode extends Node {\n  constructor(icon_texture, callback) {\n    super();\n\n    // All buttons are selectable by default.\n    this.selectable = true;\n\n    this._select_handler = callback;\n    this._icon_texture = icon_texture;\n    this._hovered = false;\n    this._hover_t = 0;\n  }\n\n  get icon_texture() {\n    return this._icon_texture;\n  }\n\n  set icon_texture(value) {\n    if (this._icon_texture == value)\n      return;\n\n    this._icon_texture = value;\n    this._icon_render_primitive.samplers.icon.texture = value;\n  }\n\n  onRendererChanged(renderer) {\n    let stream = new PrimitiveStream();\n\n    let hd = BUTTON_LAYER_DISTANCE * 0.5;\n\n    // Build a rounded rect for the background.\n    let hs = BUTTON_SIZE * 0.5;\n    let ihs = hs - BUTTON_CORNER_RADIUS;\n    stream.startGeometry();\n\n    // Rounded corners and sides\n    let segments = BUTTON_CORNER_SEGMENTS * 4;\n    for (let i = 0; i < segments; ++i) {\n      let rad = i * ((Math.PI * 2.0) / segments);\n      let x = Math.cos(rad) * BUTTON_CORNER_RADIUS;\n      let y = Math.sin(rad) * BUTTON_CORNER_RADIUS;\n      let section = Math.floor(i / BUTTON_CORNER_SEGMENTS);\n      switch (section) {\n        case 0:\n          x += ihs;\n          y += ihs;\n          break;\n        case 1:\n          x -= ihs;\n          y += ihs;\n          break;\n        case 2:\n          x -= ihs;\n          y -= ihs;\n          break;\n        case 3:\n          x += ihs;\n          y -= ihs;\n          break;\n      }\n\n      stream.pushVertex(x, y, -hd,  0, 0,  0, 0, 1);\n\n      if (i > 1) {\n        stream.pushTriangle(0, i-1, i);\n      }\n    }\n\n    stream.endGeometry();\n\n    let button_primitive = stream.finishPrimitive(renderer);\n    this._button_render_primitive = renderer.createRenderPrimitive(button_primitive, new ButtonMaterial());\n    this.addRenderPrimitive(this._button_render_primitive);\n\n    // Build a simple textured quad for the foreground.\n    hs = BUTTON_ICON_SIZE * 0.5;\n    stream.clear();\n    stream.startGeometry();\n\n    stream.pushVertex(-hs, hs, hd,  0, 0,  0, 0, 1);\n    stream.pushVertex(-hs, -hs, hd,  0, 1,  0, 0, 1);\n    stream.pushVertex(hs, -hs, hd,  1, 1,  0, 0, 1);\n    stream.pushVertex(hs, hs, hd,  1, 0,  0, 0, 1);\n\n    stream.pushTriangle(0, 1, 2);\n    stream.pushTriangle(0, 2, 3);\n\n    stream.endGeometry();\n\n    let icon_primitive = stream.finishPrimitive(renderer);\n    let icon_material = new ButtonIconMaterial();\n    icon_material.icon.texture = this._icon_texture;\n    this._icon_render_primitive = renderer.createRenderPrimitive(icon_primitive, icon_material);\n    this.addRenderPrimitive(this._icon_render_primitive);\n  }\n\n  onHoverStart() {\n    this._hovered = true;\n  }\n\n  onHoverEnd() {\n    this._hovered = false;\n  }\n\n  _updateHoverState() {\n    let t = this._hover_t / BUTTON_HOVER_TRANSITION_TIME_MS;\n    // Cubic Ease In/Out\n    // TODO: Get a better animation system\n    let hover_amount = t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1;\n    this._button_render_primitive.uniforms.hoverAmount.value = hover_amount;\n    this._icon_render_primitive.uniforms.hoverAmount.value = hover_amount;\n  }\n\n  onUpdate(timestamp, frame_delta) {\n    if (this._hovered && this._hover_t < BUTTON_HOVER_TRANSITION_TIME_MS) {\n      this._hover_t = Math.min(BUTTON_HOVER_TRANSITION_TIME_MS, this._hover_t + frame_delta);\n      this._updateHoverState();\n    } else if (!this._hovered && this._hover_t > 0) {\n      this._hover_t = Math.max(0.0, this._hover_t - frame_delta);\n      this._updateHoverState()\n    }\n    // TODO: Animate hover state\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/button-node.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { Material } from '../core/material.js'\nimport { Primitive, PrimitiveAttribute } from '../core/primitive.js'\nimport { Node } from '../core/node.js'\nimport { UrlTexture } from '../core/texture.js'\nimport { BoxBuilder } from '../geometry/box-builder.js'\n\nclass CubeSeaMaterial extends Material {\n  constructor(heavy = false) {\n    super();\n\n    this.heavy = heavy;\n\n    this.base_color = this.defineSampler(\"baseColor\");\n  }\n\n  get material_name() {\n    return 'CUBE_SEA';\n  }\n\n  get vertex_source() {\n    return `\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    attribute vec3 NORMAL;\n\n    varying vec2 vTexCoord;\n    varying vec3 vLight;\n\n    const vec3 lightDir = vec3(0.75, 0.5, 1.0);\n    const vec3 ambientColor = vec3(0.5, 0.5, 0.5);\n    const vec3 lightColor = vec3(0.75, 0.75, 0.75);\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec3 normalRotated = vec3(model * vec4(NORMAL, 0.0));\n      float lightFactor = max(dot(normalize(lightDir), normalRotated), 0.0);\n      vLight = ambientColor + (lightColor * lightFactor);\n      vTexCoord = TEXCOORD_0;\n      return proj * view * model * vec4(POSITION, 1.0);\n    }`;\n  }\n\n  get fragment_source() {\n    if (!this.heavy) {\n      return `\n      precision mediump float;\n      uniform sampler2D baseColor;\n      varying vec2 vTexCoord;\n      varying vec3 vLight;\n\n      vec4 fragment_main() {\n        return vec4(vLight, 1.0) * texture2D(baseColor, vTexCoord);\n      }`;\n    } else {\n      // Used when we want to stress the GPU a bit more.\n      // Stolen with love from https://www.clicktorelease.com/code/codevember-2016/4/\n      return `\n      precision mediump float;\n\n      uniform sampler2D diffuse;\n      varying vec2 vTexCoord;\n      varying vec3 vLight;\n\n      vec2 dimensions = vec2(64, 64);\n      float seed = 0.42;\n\n      vec2 hash( vec2 p ) {\n        p=vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)));\n        return fract(sin(p)*18.5453);\n      }\n\n      vec3 hash3( vec2 p ) {\n          vec3 q = vec3( dot(p,vec2(127.1,311.7)),\n                 dot(p,vec2(269.5,183.3)),\n                 dot(p,vec2(419.2,371.9)) );\n        return fract(sin(q)*43758.5453);\n      }\n\n      float iqnoise( in vec2 x, float u, float v ) {\n        vec2 p = floor(x);\n        vec2 f = fract(x);\n        float k = 1.0+63.0*pow(1.0-v,4.0);\n        float va = 0.0;\n        float wt = 0.0;\n        for( int j=-2; j<=2; j++ )\n          for( int i=-2; i<=2; i++ ) {\n            vec2 g = vec2( float(i),float(j) );\n            vec3 o = hash3( p + g )*vec3(u,u,1.0);\n            vec2 r = g - f + o.xy;\n            float d = dot(r,r);\n            float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );\n            va += o.z*ww;\n            wt += ww;\n          }\n        return va/wt;\n      }\n\n      // return distance, and cell id\n      vec2 voronoi( in vec2 x ) {\n        vec2 n = floor( x );\n        vec2 f = fract( x );\n        vec3 m = vec3( 8.0 );\n        for( int j=-1; j<=1; j++ )\n          for( int i=-1; i<=1; i++ ) {\n            vec2  g = vec2( float(i), float(j) );\n            vec2  o = hash( n + g );\n            vec2  r = g - f + (0.5+0.5*sin(seed+6.2831*o));\n            float d = dot( r, r );\n            if( d<m.x )\n              m = vec3( d, o );\n          }\n        return vec2( sqrt(m.x), m.y+m.z );\n      }\n\n      vec4 fragment_main() {\n        vec2 uv = ( vTexCoord );\n        uv *= vec2( 10., 10. );\n        uv += seed;\n        vec2 p = 0.5 - 0.5*sin( 0.*vec2(1.01,1.71) );\n\n        vec2 c = voronoi( uv );\n        vec3 col = vec3( c.y / 2. );\n\n        float f = iqnoise( 1. * uv + c.y, p.x, p.y );\n        col *= 1.0 + .25 * vec3( f );\n\n        return vec4(vLight, 1.0) * texture2D(diffuse, vTexCoord) * vec4( col, 1. );\n      }`;\n    }\n  }\n}\n\nexport class CubeSea extends Node {\n  constructor(options = {}) {\n    super();\n\n    // Test variables\n    // If true, use a very heavyweight shader to stress the GPU.\n    this.heavy_gpu = !!options.heavy_gpu;\n\n    // Number and size of the static cubes. Warning, large values\n    // don't render right due to overflow of the int16 indices.\n    this.cube_count = options.cube_count || (this.heavy_gpu ? 12 : 10);\n    this.cube_scale = options.cube_scale || 1.0;\n\n    // Draw only half the world cubes. Helps test variable render cost\n    // when combined with heavyGpu.\n    this.half_only = !!options.half_only;\n\n    // Automatically spin the world cubes. Intended for automated testing,\n    // not recommended for viewing in a headset.\n    this.auto_rotate = !!options.auto_rotate;\n\n    this._texture = new UrlTexture(options.image_url || 'media/textures/cube-sea.png');\n\n    this._material = new CubeSeaMaterial(this.heavy_gpu);\n    this._material.base_color.texture = this._texture;\n\n    this._render_primitive = null;\n  }\n\n  onRendererChanged(renderer) {\n    this._render_primitive = null;\n\n    let box_builder = new BoxBuilder();\n\n    // Build the spinning \"hero\" cubes\n    box_builder.pushCube([0, 0.25, -0.8], 0.1);\n    box_builder.pushCube([0.8, 0.25, 0], 0.1);\n    box_builder.pushCube([0, 0.25, 0.8], 0.1);\n    box_builder.pushCube([-0.8, 0.25, 0], 0.1);\n\n    let hero_primitive = box_builder.finishPrimitive(renderer);\n\n    this.hero_node = renderer.createMesh(hero_primitive, this._material);\n\n    this.rebuildCubes(box_builder);\n\n    this.cube_sea_node = new Node();\n    this.cube_sea_node.addRenderPrimitive(this._render_primitive);\n\n    this.addNode(this.cube_sea_node);\n    this.addNode(this.hero_node);\n\n    return this.waitForComplete();\n  }\n\n  rebuildCubes(box_builder) {\n    if (!this._renderer)\n      return;\n\n    if (!box_builder)\n      box_builder = new BoxBuilder();\n    else\n      box_builder.clear();\n\n    let size = 0.4 * this.cube_scale;\n\n    // Build the cube sea\n    let half_grid = this.cube_count * 0.5;\n    for (let x = 0; x < this.cube_count; ++x) {\n      for (let y = 0; y < this.cube_count; ++y) {\n        for (let z = 0; z < this.cube_count; ++z) {\n          let pos = [x - half_grid, y - half_grid, z - half_grid];\n          // Only draw cubes on one side. Useful for testing variable render\n          // cost that depends on view direction.\n          if (this.half_only && pos[0] < 0)\n            continue;\n\n          // Don't place a cube in the center of the grid.\n          if (pos[0] == 0 && pos[1] == 0 && pos[2] == 0)\n            continue;\n\n          box_builder.pushCube(pos, size);\n        }\n      }\n    }\n\n    if (this.cube_count > 12) {\n      // Each cube has 6 sides with 2 triangles and 3 indices per triangle, so\n      // the total number of indices needed is cube_count^3 * 36. This exceeds\n      // the short index range past 12 cubes.\n      box_builder.index_type = 5125;  // gl.UNSIGNED_INT\n    }\n    let cube_sea_primitive = box_builder.finishPrimitive(this._renderer);\n\n    if (!this._render_primitive) {\n      this._render_primitive = this._renderer.createRenderPrimitive(cube_sea_primitive, this._material);\n    } else {\n      this._render_primitive.setPrimitive(cube_sea_primitive);\n    }\n  }\n\n  onUpdate(timestamp, frame_delta) {\n    if (this.auto_rotate) {\n      mat4.fromRotation(this.cube_sea_node.matrix, timestamp / 500, [0, -1, 0]);\n    }\n    mat4.fromRotation(this.hero_node.matrix, timestamp / 2000, [0, 1, 0]);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/cube-sea.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nNode for displaying 2D or stereo videos on a quad.\n*/\n\nimport { Material } from '../core/material.js'\nimport { Primitive, PrimitiveAttribute } from '../core/primitive.js'\nimport { Node } from '../core/node.js'\nimport { VideoTexture } from '../core/texture.js'\nimport { ButtonNode } from './button-node.js'\n\nconst GL = WebGLRenderingContext; // For enums\n\nclass VideoMaterial extends Material {\n  constructor() {\n    super();\n\n    this.image = this.defineSampler(\"diffuse\");\n\n    this.tex_coord_scale_offset = this.defineUniform(\"texCoordScaleOffset\",\n                                                      [1.0, 1.0, 0.0, 0.0,\n                                                       1.0, 1.0, 0.0, 0.0], 4);\n  }\n\n  get material_name() {\n    return 'VIDEO_PLAYER';\n  }\n\n  get vertex_source() {\n    return `\n    uniform int EYE_INDEX;\n    uniform vec4 texCoordScaleOffset[2];\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec4 scaleOffset = texCoordScaleOffset[EYE_INDEX];\n      vTexCoord = (TEXCOORD_0 * scaleOffset.xy) + scaleOffset.zw;\n      vec4 out_vec = proj * view * model * vec4(POSITION, 1.0);\n      return out_vec;\n    }`;\n  }\n\n  get fragment_source() {\n    return `\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(diffuse, vTexCoord);\n    }`;\n  }\n}\n\nexport class VideoNode extends Node {\n  constructor(options) {\n    super();\n\n    this._video = options.video;\n    this._display_mode = options.display_mode || \"mono\";\n\n    this._video_texture = new VideoTexture(this._video);\n  }\n\n  get aspectRatio() {\n    let width = this._video.videoWidth;\n    let height = this._video.videoHeight;\n\n    switch (this._display_mode) {\n      case 'stereoTopBottom': height *= 0.5; break;\n      case 'stereoLeftRight': width *= 0.5; break;\n    }\n\n    if (!height || !width) {\n      return 1;\n    }\n\n    return width / height;\n  }\n\n  onRendererChanged(renderer) {\n    let vertices = [\n      -1.0,  1.0, 0.0,  0.0, 0.0,\n       1.0,  1.0, 0.0,  1.0, 0.0,\n       1.0, -1.0, 0.0,  1.0, 1.0,\n      -1.0, -1.0, 0.0,  0.0, 1.0,\n    ];\n    let indices = [\n      0, 2, 1,\n      0, 3, 2\n    ];\n\n    let vertex_buffer = renderer.createRenderBuffer(GL.ARRAY_BUFFER, new Float32Array(vertices));\n    let index_buffer = renderer.createRenderBuffer(GL.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices));\n\n    let attribs = [\n      new PrimitiveAttribute(\"POSITION\", vertex_buffer, 3, GL.FLOAT, 20, 0),\n      new PrimitiveAttribute(\"TEXCOORD_0\", vertex_buffer, 2, GL.FLOAT, 20, 12),\n    ];\n  \n    let primitive = new Primitive(attribs, indices.length);\n    primitive.setIndexBuffer(index_buffer);\n    primitive.setBounds([-1.0, -1.0, 0.0], [1.0, 1.0, 0.015]);\n\n    let material = new VideoMaterial();\n    material.image.texture = this._video_texture;\n\n    switch(this._display_mode) {\n      case \"mono\":\n        material.tex_coord_scale_offset.value = [1.0, 1.0, 0.0, 0.0,\n                                                 1.0, 1.0, 0.0, 0.0];\n        break;\n      case \"stereoTopBottom\":\n        material.tex_coord_scale_offset.value = [1.0, 0.5, 0.0, 0.0,\n                                                 1.0, 0.5, 0.0, 0.5];\n        break;\n      case \"stereoLeftRight\":\n        material.tex_coord_scale_offset.value = [0.5, 1.0, 0.0, 0.0,\n                                                 0.5, 1.0, 0.5, 0.0];\n        break;\n    }\n\n    let render_primitive = renderer.createRenderPrimitive(primitive, material);\n    this.addRenderPrimitive(render_primitive);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/video.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { Renderer, RenderView } from '../core/renderer.js'\nimport { BoundsRenderer } from '../nodes/bounds-renderer.js'\nimport { InputRenderer } from '../nodes/input-renderer.js'\nimport { Skybox } from '../nodes/skybox.js'\nimport { StatsViewer } from '../nodes/stats-viewer.js'\nimport { Program } from '../core/program.js'\nimport { Node } from '../core/node.js'\nimport { GLTF2Loader } from '../loaders/gltf2.js'\n\nexport class WebXRView extends RenderView {\n  constructor(view, pose, layer) {\n    super(\n      view ? view.projectionMatrix : null,\n      (pose && view) ? pose.getViewMatrix(view) : null,\n      (layer && view) ? layer.getViewport(view) : null,\n      view ? view.eye : 'left'\n    );\n  }\n}\n\nexport class Scene extends Node {\n  constructor() {\n    super();\n\n    this._timestamp = -1;\n    this._frame_delta = 0;\n    this._stats_standing = false;\n    this._stats = null;\n    this._stats_enabled = false;\n    this.enableStats(true); // Ensure the stats are added correctly by default.\n    this._stage_bounds = null;\n    this._bounds_renderer = null;\n\n    this._input_renderer = null;\n    this._reset_input_end_frame = true;\n\n    this._skybox = null;\n    this._gltf2_loader = null;\n\n    this._last_timestamp = 0;\n\n    this._hover_frame = 0;\n    this._hovered_nodes = [];\n  }\n\n  setRenderer(renderer) {\n    // Set up a non-black clear color so that we can see if something renders\n    // wrong.\n    renderer.gl.clearColor(0.1, 0.2, 0.3, 1.0);\n\n    this._gltf2_loader = new GLTF2Loader(renderer);\n\n    this._setRenderer(renderer);\n  }\n\n  setSkybox(image_url) {\n    if (this._skybox) {\n      this.removeNode(this._skybox);\n      this._skybox = null;\n    }\n    if (image_url) {\n      this._skybox = new Skybox(image_url);\n      this.addNode(this._skybox);\n\n      if (this._renderer)\n        this._skybox.setRenderer(this._renderer);\n    }\n  }\n\n  loseRenderer() {\n    if (this._renderer) {\n      this._stats = null;\n      this.texture_loader = null;\n      this._renderer = null;\n      this._input_renderer = null;\n    }\n  }\n\n  get gltf2Loader() {\n    return this._gltf2_loader;\n  }\n\n  get inputRenderer() {\n    if (!this._input_renderer) {\n      this._input_renderer = new InputRenderer();\n      this.addNode(this._input_renderer);\n    }\n    return this._input_renderer;\n  }\n\n  // Helper function that automatically adds the appropriate visual elements for\n  // all input sources.\n  updateInputSources(frame, frame_of_ref) {\n    // FIXME: Check for the existence of the API first. This check should be\n    // removed once the input API is part of the official spec.\n    if (!frame.session.getInputSources)\n      return;\n\n    let input_sources = frame.session.getInputSources();\n\n    let new_hovered_nodes = [];\n    let last_hover_frame = this._hover_frame;\n    this._hover_frame++;\n\n    for (let input_source of input_sources) {\n      let input_pose = frame.getInputPose(input_source, frame_of_ref);\n\n      if (!input_pose) {\n        continue;\n      }\n\n      // Any time that we have a grip matrix, we'll render a controller.\n      if (input_pose.gripMatrix) {\n        this.inputRenderer.addController(input_pose.gripMatrix);\n      }\n\n      if (input_pose.pointerMatrix) {\n        if (input_source.pointerOrigin == \"hand\") {\n          // If we have a pointer matrix and the pointer origin is the users\n          // hand (as opposed to their head or the screen) use it to render\n          // a ray coming out of the input device to indicate the pointer\n          // direction.\n          this.inputRenderer.addLaserPointer(input_pose.pointerMatrix);\n        }\n\n        // If we have a pointer matrix we can also use it to render a cursor\n        // for both handheld and gaze-based input sources.\n\n        // Check and see if the pointer is pointing at any selectable objects.\n        let hit_result = this.hitTest(input_pose.pointerMatrix);\n\n        if (hit_result) {\n          // Render a cursor at the intersection point.\n          this.inputRenderer.addCursor(hit_result.intersection);\n\n          if (hit_result.node._hover_frame_id != last_hover_frame) {\n            hit_result.node.onHoverStart();\n          }\n          hit_result.node._hover_frame_id = this._hover_frame;\n          new_hovered_nodes.push(hit_result.node);\n        } else {\n          // Statically render the cursor 1 meters down the ray since we didn't\n          // hit anything selectable.\n          let cursor_pos = vec3.fromValues(0, 0, -1.0);\n          vec3.transformMat4(cursor_pos, cursor_pos, input_pose.pointerMatrix);\n          this.inputRenderer.addCursor(cursor_pos);\n        }\n      }\n    }\n\n    for (let hover_node of this._hovered_nodes) {\n      if (hover_node._hover_frame_id != this._hover_frame) {\n        hover_node.onHoverEnd();\n      }\n    }\n\n    this._hovered_nodes = new_hovered_nodes;\n  }\n\n  handleSelect(input_source, frame, frame_of_ref) {\n    let input_pose = frame.getInputPose(input_source, frame_of_ref);\n\n    if (!input_pose) {\n      return;\n    }\n\n    this.handleSelectPointer(input_pose.pointerMatrix);\n  }\n\n  handleSelectPointer(pointer_matrix) {\n    if (pointer_matrix) {\n      // Check and see if the pointer is pointing at any selectable objects.\n      let hit_result = this.hitTest(pointer_matrix);\n\n      if (hit_result) {\n        // Render a cursor at the intersection point.\n        hit_result.node.handleSelect();\n      }\n    }\n  }\n\n  enableStats(enable) {\n    if (enable == this._stats_enabled)\n      return;\n\n    this._stats_enabled = enable;\n\n    if (enable) {\n      this._stats = new StatsViewer();\n      this._stats.selectable = true;\n      this.addNode(this._stats);\n\n      if (this._stats_standing) {\n        this._stats.translation = [0, 1.4, -0.75];\n      } else {\n        this._stats.translation = [0, -0.3, -0.5];\n      }\n      this._stats.scale = [0.3, 0.3, 0.3];\n      quat.fromEuler(this._stats.rotation, -45.0, 0.0, 0.0);\n\n    } else if (!enable) {\n      if (this._stats) {\n        this.removeNode(this._stats);\n        this._stats = null;\n      }\n    }\n  }\n\n  standingStats(enable) {\n    this._stats_standing = enable;\n    if (this._stats) {\n      if (this._stats_standing) {\n        this._stats.translation = [0, 1.4, -0.75];\n      } else {\n        this._stats.translation = [0, -0.3, -0.5];\n      }\n      this._stats.scale = [0.3, 0.3, 0.3];\n      quat.fromEuler(this._stats.rotation, -45.0, 0.0, 0.0);\n    }\n  }\n\n  setBounds(stage_bounds) {\n    this._stage_bounds = stage_bounds;\n    if (stage_bounds && !this._bounds_renderer) {\n      this._bounds_renderer = new BoundsRenderer();\n      this.addNode(this._bounds_renderer);\n    }\n    if (this._bounds_renderer) {\n      this._bounds_renderer.stage_bounds = stage_bounds;\n    }\n  }\n\n  draw(projection_mat, view_mat, eye) {\n    let view = new RenderView();\n    view.projection_matrix = projection_mat;\n    view.view_matrix = view_mat;\n    if (eye) {\n      view.eye = eye;\n    }\n\n    this.drawViewArray([view]);\n  }\n\n  /** Draws the scene into the base layer of the XRFrame's session */\n  drawXRFrame(xr_frame, pose) {\n    if (!this._renderer || !pose) {\n      return;\n    }\n\n    let gl = this._renderer.gl;\n    let session = xr_frame.session;\n    // Assumed to be a XRWebGLLayer for now.\n    let layer = session.baseLayer;\n\n    if(!gl) {\n      return;\n    }\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, layer.framebuffer);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    let views = [];\n    for (let view of xr_frame.views) {\n      views.push(new WebXRView(view, pose, layer));\n    }\n\n    this.drawViewArray(views);\n  }\n\n  drawViewArray(views) {\n    // Don't draw when we don't have a valid context\n    if (!this._renderer)\n      return;\n\n    this._renderer.drawViews(views, this);\n  }\n\n  startFrame() {\n    let prev_timestamp = this._timestamp;\n    this._timestamp = performance.now();\n    if (this._stats) {\n      this._stats.begin();\n    }\n\n    if (prev_timestamp >= 0) {\n      this._frame_delta = this._timestamp - prev_timestamp;\n    } else {\n      this._frame_delta = 0;\n    }\n\n    this._update(this._timestamp, this._frame_delta);\n\n    return this._frame_delta;\n  }\n\n  endFrame() {\n    if (this._input_renderer && this._reset_input_end_frame) {\n      this._input_renderer.reset();\n    }\n\n    if (this._stats) {\n      this._stats.end();\n    }\n  }\n\n  // Override to load scene resources on construction or context restore.\n  onLoadScene(renderer) {\n    return Promise.resolve();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scenes/scene.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nThis file renders a passed in XRStageBounds object and attempts\nto render geometry on the floor to indicate where the bounds is.\nXRStageBounds' `geometry` is a series of XRStageBoundsPoints (in\nclockwise-order) with `x` and `z` properties for each.\n*/\n\nimport { Material } from '../core/material.js'\nimport { Node } from '../core/node.js'\nimport { Primitive, PrimitiveAttribute } from '../core/primitive.js'\n\nconst GL = WebGLRenderingContext; // For enums\n\nclass BoundsMaterial extends Material {\n  constructor() {\n    super();\n\n    this.state.blend = true;\n    this.state.blend_func_src = GL.SRC_ALPHA;\n    this.state.blend_func_dst = GL.ONE;\n    this.state.depth_test = false;\n  }\n\n  get material_name() {\n    return 'BOUNDS_RENDERER';\n  }\n\n  get vertex_source() {\n    return `\n    attribute vec2 POSITION;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      return proj * view * model * vec4(POSITION, 1.0);\n    }`;\n  }\n\n  get fragment_source() {\n    return `\n    precision mediump float;\n\n    vec4 fragment_main() {\n      return vec4(0.0, 1.0, 0.0, 0.3);\n    }`;\n  }\n}\n\nexport class BoundsRenderer extends Node {\n  constructor() {\n    super();\n\n    this._stage_bounds = null;\n  }\n\n  onRendererChanged(renderer) {\n    this.stage_bounds = this._stage_bounds;\n  }\n\n  get stage_bounds() {\n    return this._stage_bounds;\n  }\n\n  set stage_bounds(stage_bounds) {\n    if (this._stage_bounds) {\n      this.clearRenderPrimitives();\n    }\n    this._stage_bounds = stage_bounds;\n    if (!stage_bounds || stage_bounds.length === 0 || !this._renderer) {\n      return;\n    }\n\n    let verts = [];\n    let indices = [];\n\n    // Tessellate the bounding points from XRStageBounds and connect\n    // each point to a neighbor and 0,0,0.\n    const point_count = stage_bounds.geometry.length;\n    for (let i = 0; i < point_count; i++) {\n      const point = stage_bounds.geometry[i];\n      verts.push(point.x, 0, point.z);\n      indices.push(i, i === 0 ? point_count - 1 : i - 1, point_count);\n    }\n    // Center point\n    verts.push(0, 0, 0);\n\n    let vertex_buffer = this._renderer.createRenderBuffer(GL.ARRAY_BUFFER, new Float32Array(verts));\n    let index_buffer = this._renderer.createRenderBuffer(GL.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices));\n\n    let attribs = [\n      new PrimitiveAttribute(\"POSITION\", vertex_buffer, 3, gl.FLOAT, 12, 0),\n    ];\n  \n    let primitive = new Primitive(attribs, indices.length);\n    primitive.setIndexBuffer(index_buffer);\n\n    let render_primitive = this._renderer.createRenderPrimitive(primitive, new BoundsMaterial());\n    this.addRenderPrimitive(render_primitive);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/bounds-renderer.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { Material, RENDER_ORDER } from '../core/material.js'\nimport { Node } from '../core/node.js'\nimport { Primitive, PrimitiveAttribute } from '../core/primitive.js'\nimport { DataTexture } from '../core/texture.js'\n\nconst GL = WebGLRenderingContext; // For enums\n\n// Laser texture data, 48x1 RGBA (not premultiplied alpha). This represents a\n// \"cross section\" of the laser beam with a bright core and a feathered edge.\n// Borrowed from Chromium source code.\nconst LASER_TEXTURE_DATA = new Uint8Array([\n0xff,0xff,0xff,0x01,0xff,0xff,0xff,0x02,0xbf,0xbf,0xbf,0x04,0xcc,0xcc,0xcc,0x05,\n0xdb,0xdb,0xdb,0x07,0xcc,0xcc,0xcc,0x0a,0xd8,0xd8,0xd8,0x0d,0xd2,0xd2,0xd2,0x11,\n0xce,0xce,0xce,0x15,0xce,0xce,0xce,0x1a,0xce,0xce,0xce,0x1f,0xcd,0xcd,0xcd,0x24,\n0xc8,0xc8,0xc8,0x2a,0xc9,0xc9,0xc9,0x2f,0xc9,0xc9,0xc9,0x34,0xc9,0xc9,0xc9,0x39,\n0xc9,0xc9,0xc9,0x3d,0xc8,0xc8,0xc8,0x41,0xcb,0xcb,0xcb,0x44,0xee,0xee,0xee,0x87,\n0xfa,0xfa,0xfa,0xc8,0xf9,0xf9,0xf9,0xc9,0xf9,0xf9,0xf9,0xc9,0xfa,0xfa,0xfa,0xc9,\n0xfa,0xfa,0xfa,0xc9,0xf9,0xf9,0xf9,0xc9,0xf9,0xf9,0xf9,0xc9,0xfa,0xfa,0xfa,0xc8,\n0xee,0xee,0xee,0x87,0xcb,0xcb,0xcb,0x44,0xc8,0xc8,0xc8,0x41,0xc9,0xc9,0xc9,0x3d,\n0xc9,0xc9,0xc9,0x39,0xc9,0xc9,0xc9,0x34,0xc9,0xc9,0xc9,0x2f,0xc8,0xc8,0xc8,0x2a,\n0xcd,0xcd,0xcd,0x24,0xce,0xce,0xce,0x1f,0xce,0xce,0xce,0x1a,0xce,0xce,0xce,0x15,\n0xd2,0xd2,0xd2,0x11,0xd8,0xd8,0xd8,0x0d,0xcc,0xcc,0xcc,0x0a,0xdb,0xdb,0xdb,0x07,\n0xcc,0xcc,0xcc,0x05,0xbf,0xbf,0xbf,0x04,0xff,0xff,0xff,0x02,0xff,0xff,0xff,0x01,\n]);\n\nconst LASER_LENGTH = 1.0;\nconst LASER_DIAMETER = 0.01;\nconst LASER_FADE_END = 0.535;\nconst LASER_FADE_POINT = 0.5335;\nconst LASER_DEFAULT_COLOR = [1.0, 1.0, 1.0, 0.25];\n\nconst CURSOR_RADIUS = 0.004;\nconst CURSOR_SHADOW_RADIUS = 0.007;\nconst CURSOR_SHADOW_INNER_LUMINANCE = 0.5;\nconst CURSOR_SHADOW_OUTER_LUMINANCE = 0.0;\nconst CURSOR_SHADOW_INNER_OPACITY = 0.75;\nconst CURSOR_SHADOW_OUTER_OPACITY = 0.0;\nconst CURSOR_OPACITY = 0.9;\nconst CURSOR_SEGMENTS = 16;\nconst CURSOR_DEFAULT_COLOR = [1.0, 1.0, 1.0, 1.0];\nconst CURSOR_DEFAULT_HIDDEN_COLOR = [0.5, 0.5, 0.5, 0.25];\n\nconst DEFAULT_RESET_OPTIONS = {\n  controllers: true,\n  lasers: true,\n  cursors: true\n};\n\nclass LaserMaterial extends Material {\n  constructor() {\n    super();\n    this.render_order = RENDER_ORDER.ADDITIVE;\n    this.state.cull_face = false;\n    this.state.blend = true;\n    this.state.blend_func_src = GL.ONE;\n    this.state.blend_func_dst = GL.ONE;\n    this.state.depth_mask = false;\n\n    this.laser = this.defineSampler(\"diffuse\");\n    this.laser.texture = new DataTexture(LASER_TEXTURE_DATA, 48, 1);\n    this.laser_color = this.defineUniform(\"laserColor\", LASER_DEFAULT_COLOR);\n  }\n\n  get material_name() {\n    return 'INPUT_LASER';\n  }\n\n  get vertex_source() {\n    return `\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vTexCoord = TEXCOORD_0;\n      return proj * view * model * vec4(POSITION, 1.0);\n    }`;\n  }\n\n  get fragment_source() {\n    return `\n    precision mediump float;\n\n    uniform vec4 laserColor;\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    const float fade_point = ${LASER_FADE_POINT};\n    const float fade_end = ${LASER_FADE_END};\n\n    vec4 fragment_main() {\n      vec2 uv = vTexCoord;\n      float front_fade_factor = 1.0 - clamp(1.0 - (uv.y - fade_point) / (1.0 - fade_point), 0.0, 1.0);\n      float back_fade_factor = clamp((uv.y - fade_point) / (fade_end - fade_point), 0.0, 1.0);\n      vec4 color = laserColor * texture2D(diffuse, vTexCoord);\n      float opacity = color.a * front_fade_factor * back_fade_factor;\n      return vec4(color.rgb * opacity, opacity);\n    }`;\n  }\n}\n\nconst CURSOR_VERTEX_SHADER = `\nattribute vec4 POSITION;\n\nvarying float vLuminance;\nvarying float vOpacity;\n\nvec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n  vLuminance = POSITION.z;\n  vOpacity = POSITION.w;\n\n  // Billboarded, constant size vertex transform.\n  vec4 screenPos = proj * view * model * vec4(0.0, 0.0, 0.0, 1.0);\n  screenPos /= screenPos.w;\n  screenPos.xy += POSITION.xy;\n  return screenPos;\n}`;\n\nconst CURSOR_FRAGMENT_SHADER = `\nprecision mediump float;\n\nuniform vec4 cursorColor;\nvarying float vLuminance;\nvarying float vOpacity;\n\nvec4 fragment_main() {\n  vec3 color = cursorColor.rgb * vLuminance;\n  float opacity = cursorColor.a * vOpacity;\n  return vec4(color * opacity, opacity);\n}`;\n\n// Cursors are drawn as billboards that always face the camera and are rendered\n// as a fixed size no matter how far away they are.\nclass CursorMaterial extends Material {\n  constructor() {\n    super();\n    this.render_order = RENDER_ORDER.ADDITIVE;\n    this.state.cull_face = false;\n    this.state.blend = true;\n    this.state.blend_func_src = GL.ONE;\n    this.state.depth_mask = false;\n\n    this.cursor_color = this.defineUniform(\"cursorColor\", CURSOR_DEFAULT_COLOR);\n  }\n\n  get material_name() {\n    return 'INPUT_CURSOR';\n  }\n\n  get vertex_source() {\n    return CURSOR_VERTEX_SHADER;\n  }\n\n  get fragment_source() {\n    return CURSOR_FRAGMENT_SHADER;\n  }\n}\n\nclass CursorHiddenMaterial extends Material {\n  constructor() {\n    super();\n    this.render_order = RENDER_ORDER.ADDITIVE;\n    this.state.cull_face = false;\n    this.state.blend = true;\n    this.state.blend_func_src = GL.ONE;\n    this.state.depth_func = GL.GEQUAL;\n    this.state.depth_mask = false;\n\n    this.cursor_color = this.defineUniform(\"cursorColor\", CURSOR_DEFAULT_HIDDEN_COLOR);\n  }\n\n  // TODO: Rename to \"program_name\"\n  get material_name() {\n    return 'INPUT_CURSOR_2';\n  }\n\n  get vertex_source() {\n    return CURSOR_VERTEX_SHADER;\n  }\n\n  get fragment_source() {\n    return CURSOR_FRAGMENT_SHADER;\n  }\n}\n\nexport class InputRenderer extends Node {\n  constructor() {\n    super();\n\n    this._max_input_elements = 32;\n\n    this._controllers = [];\n    this._controller_node = null;\n    this._controller_node_handedness = null;\n    this._lasers = null;\n    this._cursors = null;\n\n    this._active_controllers = 0;\n    this._active_lasers = 0;\n    this._active_cursors = 0;\n  }\n\n  onRendererChanged(renderer) {\n    this._controllers = [];\n    this._controller_node = null;\n    this._controller_node_handedness = null;\n    this._lasers = null;\n    this._cursors = null;\n\n    this._active_controllers = 0;\n    this._active_lasers = 0;\n    this._active_cursors = 0;\n  }\n\n  setControllerMesh(controller_node, handedness = 'right') {\n    this._controller_node = controller_node;\n    this._controller_node_handedness = handedness;\n  }\n\n  addController(grip_matrix) {\n    if (!this._controller_node) {\n        return;\n    }\n\n    let controller = null;\n    if (this._active_controllers < this._controllers.length) {\n      controller = this._controllers[this._active_controllers];\n    } else {\n      controller = this._controller_node.clone();\n      this.addNode(controller);\n      this._controllers.push(controller);\n    }\n    this._active_controllers = (this._active_controllers + 1) % this._max_input_elements;\n\n    controller.matrix = grip_matrix;\n    controller.visible = true;\n  }\n\n  addLaserPointer(pointer_matrix) {\n    // Create the laser pointer mesh if needed.\n    if (!this._lasers && this._renderer) {\n      this._lasers = [this._createLaserMesh()];\n      this.addNode(this._lasers[0]);\n    }\n\n    let laser = null;\n    if (this._active_lasers < this._lasers.length) {\n      laser = this._lasers[this._active_lasers];\n    } else {\n      laser = this._lasers[0].clone();\n      this.addNode(laser);\n      this._lasers.push(laser);\n    }\n    this._active_lasers = (this._active_lasers + 1) % this._max_input_elements;\n\n    laser.matrix = pointer_matrix;\n    laser.visible = true;\n  }\n\n  addCursor(cursor_pos) {\n    // Create the cursor mesh if needed.\n    if (!this._cursors && this._renderer) {\n      this._cursors = [this._createCursorMesh()];\n      this.addNode(this._cursors[0]);\n    }\n\n    let cursor = null;\n    if (this._active_cursors < this._cursors.length) {\n      cursor = this._cursors[this._active_cursors];\n    } else {\n      cursor = this._cursors[0].clone();\n      this.addNode(cursor);\n      this._cursors.push(cursor);\n    }\n    this._active_cursors = (this._active_cursors + 1) % this._max_input_elements;\n\n    cursor.translation = cursor_pos;\n    cursor.visible = true;\n  }\n\n  reset(options) {\n    if (!options) {\n      options = DEFAULT_RESET_OPTIONS;\n    }\n    if (this._controllers && options.controllers) {\n      for (let controller of this._controllers) {\n        controller.visible = false;\n      }\n      this._active_controllers = 0;\n    }\n    if (this._lasers && options.lasers) {\n      for (let laser of this._lasers) {\n        laser.visible = false;\n      }\n      this._active_lasers = 0;\n    }\n    if (this._cursors && options.cursors) {\n      for (let cursor of this._cursors) {\n        cursor.visible = false;\n      }\n      this._active_cursors = 0;\n    }\n  }\n\n  _createLaserMesh() {\n    let gl = this._renderer._gl;\n\n    let lr = LASER_DIAMETER * 0.5;\n    let ll = LASER_LENGTH;\n\n    // Laser is rendered as cross-shaped beam\n    let laser_verts = [\n    //X    Y     Z     U    V\n      0.0,  lr, 0.0,  0.0, 1.0,\n      0.0,  lr, -ll,  0.0, 0.0,\n      0.0, -lr, 0.0,  1.0, 1.0,\n      0.0, -lr, -ll,  1.0, 0.0,\n\n       lr, 0.0, 0.0,  0.0, 1.0,\n       lr, 0.0, -ll,  0.0, 0.0,\n      -lr, 0.0, 0.0,  1.0, 1.0,\n      -lr, 0.0, -ll,  1.0, 0.0,\n\n      0.0, -lr, 0.0,  0.0, 1.0,\n      0.0, -lr, -ll,  0.0, 0.0,\n      0.0,  lr, 0.0,  1.0, 1.0,\n      0.0,  lr, -ll,  1.0, 0.0,\n\n      -lr, 0.0, 0.0,  0.0, 1.0,\n      -lr, 0.0, -ll,  0.0, 0.0,\n       lr, 0.0, 0.0,  1.0, 1.0,\n       lr, 0.0, -ll,  1.0, 0.0,\n    ];\n    let laser_indices = [\n      0, 1, 2, 1, 3, 2,\n      4, 5, 6, 5, 7, 6,\n      8, 9, 10, 9, 11, 10,\n      12, 13, 14, 13, 15, 14,\n    ];\n  \n    let laser_vertex_buffer = this._renderer.createRenderBuffer(gl.ARRAY_BUFFER, new Float32Array(laser_verts));\n    let laser_index_buffer = this._renderer.createRenderBuffer(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(laser_indices));\n\n    let laser_index_count = laser_indices.length;\n\n    let laser_attribs = [\n      new PrimitiveAttribute(\"POSITION\", laser_vertex_buffer, 3, gl.FLOAT, 20, 0),\n      new PrimitiveAttribute(\"TEXCOORD_0\", laser_vertex_buffer, 2, gl.FLOAT, 20, 12),\n    ];\n  \n    let laser_primitive = new Primitive(laser_attribs, laser_index_count);\n    laser_primitive.setIndexBuffer(laser_index_buffer);\n\n    let laser_material = new LaserMaterial();\n\n    let laser_render_primitive = this._renderer.createRenderPrimitive(laser_primitive, laser_material);\n    let mesh_node = new Node();\n    mesh_node.addRenderPrimitive(laser_render_primitive);\n    return mesh_node;\n  }\n\n  _createCursorMesh() {\n    let gl = this._renderer._gl;\n\n    let cr = CURSOR_RADIUS;\n\n    // Cursor is a circular white dot with a dark \"shadow\" skirt around the edge\n    // that fades from black to transparent as it moves out from the center.\n    // Cursor verts are packed as [X, Y, Luminance, Opacity]\n    let cursor_verts = [];\n    let cursor_indices = [];\n\n    let seg_rad = (2.0 * Math.PI) / CURSOR_SEGMENTS;\n\n    // Cursor center\n    for (let i = 0; i < CURSOR_SEGMENTS; ++i) {\n      let rad = i * seg_rad;\n      let x = Math.cos(rad);\n      let y = Math.sin(rad);\n      cursor_verts.push(x * CURSOR_RADIUS, y * CURSOR_RADIUS, 1.0, CURSOR_OPACITY);\n\n      if (i > 1) {\n        cursor_indices.push(0, i-1, i);\n      }\n    }\n\n    let index_offset = CURSOR_SEGMENTS;\n\n    // Cursor Skirt\n    for (let i = 0; i < CURSOR_SEGMENTS; ++i) {\n      let rad = i * seg_rad;\n      let x = Math.cos(rad);\n      let y = Math.sin(rad);\n      cursor_verts.push(x * CURSOR_RADIUS, y * CURSOR_RADIUS,\n          CURSOR_SHADOW_INNER_LUMINANCE, CURSOR_SHADOW_INNER_OPACITY);\n      cursor_verts.push(x * CURSOR_SHADOW_RADIUS, y * CURSOR_SHADOW_RADIUS,\n          CURSOR_SHADOW_OUTER_LUMINANCE, CURSOR_SHADOW_OUTER_OPACITY);\n\n      if (i > 0) {\n        let idx = index_offset + (i * 2);\n        cursor_indices.push(idx-2, idx-1, idx);\n        cursor_indices.push(idx-1, idx+1, idx);\n      }\n    }\n\n    let idx = index_offset + (CURSOR_SEGMENTS * 2);\n    cursor_indices.push(idx-2, idx-1, index_offset);\n    cursor_indices.push(idx-1, index_offset+1, index_offset);\n\n    let cursor_vertex_buffer = this._renderer.createRenderBuffer(gl.ARRAY_BUFFER, new Float32Array(cursor_verts));\n    let cursor_index_buffer = this._renderer.createRenderBuffer(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(cursor_indices));\n\n    let cursor_index_count = cursor_indices.length;\n\n    let cursor_attribs = [\n      new PrimitiveAttribute(\"POSITION\", cursor_vertex_buffer, 4, gl.FLOAT, 16, 0),\n    ];\n  \n    let cursor_primitive = new Primitive(cursor_attribs, cursor_index_count);\n    cursor_primitive.setIndexBuffer(cursor_index_buffer);\n\n    let cursor_material = new CursorMaterial();\n    let cursor_hidden_material = new CursorHiddenMaterial();\n\n    // Cursor renders two parts: The bright opaque cursor for areas where it's\n    // not obscured and a more transparent, darker version for areas where it's\n    // behind another object.\n    let cursor_render_primitive = this._renderer.createRenderPrimitive(cursor_primitive, cursor_material);\n    let cursor_hidden_render_primitive = this._renderer.createRenderPrimitive(cursor_primitive, cursor_hidden_material);\n    let mesh_node = new Node();\n    mesh_node.addRenderPrimitive(cursor_render_primitive);\n    mesh_node.addRenderPrimitive(cursor_hidden_render_primitive);\n    return mesh_node;\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/input-renderer.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nNode for displaying 360 equirect images as a skybox.\n*/\n\nimport { Material, RENDER_ORDER } from '../core/material.js'\nimport { Primitive, PrimitiveAttribute } from '../core/primitive.js'\nimport { Node } from '../core/node.js'\nimport { UrlTexture } from '../core/texture.js'\n\nconst GL = WebGLRenderingContext; // For enums\n\nclass SkyboxMaterial extends Material {\n  constructor() {\n    super();\n    this.render_order = RENDER_ORDER.SKY;\n    this.state.depth_func = GL.LEQUAL;\n    this.state.depth_mask = false;\n\n    this.image = this.defineSampler(\"diffuse\");\n\n    this.tex_coord_scale_offset = this.defineUniform(\"texCoordScaleOffset\",\n                                                      [1.0, 1.0, 0.0, 0.0,\n                                                       1.0, 1.0, 0.0, 0.0], 4);\n  }\n\n  get material_name() {\n    return 'SKYBOX';\n  }\n\n  get vertex_source() {\n    return `\n    uniform int EYE_INDEX;\n    uniform vec4 texCoordScaleOffset[2];\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec4 scaleOffset = texCoordScaleOffset[EYE_INDEX];\n      vTexCoord = (TEXCOORD_0 * scaleOffset.xy) + scaleOffset.zw;\n      // Drop the translation portion of the view matrix\n      view[3].xyz = vec3(0.0, 0.0, 0.0);\n      vec4 out_vec = proj * view * model * vec4(POSITION, 1.0);\n\n      // Returning the W component for both Z and W forces the geometry depth to\n      // the far plane. When combined with a depth func of LEQUAL this makes the\n      // sky write to any depth fragment that has not been written to yet.\n      return out_vec.xyww;\n    }`;\n  }\n\n  get fragment_source() {\n    return `\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(diffuse, vTexCoord);\n    }`;\n  }\n}\n\nexport class Skybox extends Node {\n  constructor(options) {\n    super();\n\n    this._image_url = options.image_url;\n    this._display_mode = options.display_mode || \"mono\";\n    this._rotation_y = options.rotation_y || 0;\n  }\n\n  onRendererChanged(renderer) {\n    let vertices = [];\n    let indices = [];\n\n    let lat_segments = 40;\n    let lon_segments = 40;\n\n    // Create the vertices/indices\n    for (let i=0; i <= lat_segments; ++i) {\n      let theta = i * Math.PI / lat_segments;\n      let sin_theta = Math.sin(theta);\n      let cos_theta = Math.cos(theta);\n\n      let idx_offset_a = i * (lon_segments+1);\n      let idx_offset_b = (i+1) * (lon_segments+1);\n\n      for (let j=0; j <= lon_segments; ++j) {\n        let phi = (j * 2 * Math.PI / lon_segments) + this._rotation_y;\n        let x = Math.sin(phi) * sin_theta;\n        let y = cos_theta;\n        let z = -Math.cos(phi) * sin_theta;\n        let u = (j / lon_segments);\n        let v = (i / lat_segments);\n\n        // Vertex shader will force the geometry to the far plane, so the\n        // radius of the sphere is immaterial.\n        vertices.push(x, y, z, u, v);\n\n        if (i < lat_segments && j < lon_segments) {\n          let idx_a = idx_offset_a+j;\n          let idx_b = idx_offset_b+j;\n\n          indices.push(idx_a, idx_b, idx_a+1,\n                       idx_b, idx_b+1, idx_a+1);\n        }\n      }\n    }\n\n    let vertex_buffer = renderer.createRenderBuffer(GL.ARRAY_BUFFER, new Float32Array(vertices));\n    let index_buffer = renderer.createRenderBuffer(GL.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices));\n\n    let attribs = [\n      new PrimitiveAttribute(\"POSITION\", vertex_buffer, 3, GL.FLOAT, 20, 0),\n      new PrimitiveAttribute(\"TEXCOORD_0\", vertex_buffer, 2, GL.FLOAT, 20, 12),\n    ];\n  \n    let primitive = new Primitive(attribs, indices.length);\n    primitive.setIndexBuffer(index_buffer);\n\n    let material = new SkyboxMaterial();\n    material.image.texture = new UrlTexture(this._image_url);\n\n    switch(this._display_mode) {\n      case \"mono\":\n        material.tex_coord_scale_offset.value = [1.0, 1.0, 0.0, 0.0,\n                                                 1.0, 1.0, 0.0, 0.0];\n        break;\n      case \"stereoTopBottom\":\n        material.tex_coord_scale_offset.value = [1.0, 0.5, 0.0, 0.0,\n                                                 1.0, 0.5, 0.0, 0.5];\n        break;\n      case \"stereoLeftRight\":\n        material.tex_coord_scale_offset.value = [0.5, 1.0, 0.0, 0.0,\n                                                 0.5, 1.0, 0.5, 0.0];\n        break;\n    }\n\n    let render_primitive = renderer.createRenderPrimitive(primitive, material);\n    this.addRenderPrimitive(render_primitive);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/skybox.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nHeavily inspired by Mr. Doobs stats.js, this FPS counter is rendered completely\nwith WebGL, allowing it to be shown in cases where overlaid HTML elements aren't\nusable (like WebXR), or if you want the FPS counter to be rendered as part of\nyour scene.\n*/\n\nimport { Material } from '../core/material.js'\nimport { Node } from '../core/node.js'\nimport { Primitive, PrimitiveAttribute } from '../core/primitive.js'\nimport { SevenSegmentText } from './seven-segment-text.js'\n\nconst SEGMENTS = 30;\nconst MAX_FPS = 90;\n\nclass StatsMaterial extends Material {\n  get material_name() {\n    return 'STATS_VIEWER';\n  }\n\n  get vertex_source() {\n    return `\n    attribute vec3 POSITION;\n    attribute vec3 COLOR_0;\n    varying vec4 vColor;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vColor = vec4(COLOR_0, 1.0);\n      return proj * view * model * vec4(POSITION, 1.0);\n    }`;\n  }\n\n  get fragment_source() {\n    return `\n    precision mediump float;\n    varying vec4 vColor;\n\n    vec4 fragment_main() {\n      return vColor;\n    }`;\n  }\n}\n\nfunction segmentToX(i) {\n  return ((0.9/SEGMENTS) * i) - 0.45;\n}\n\nfunction fpsToY(value) {\n  return (Math.min(value, MAX_FPS) * (0.7 / MAX_FPS)) - 0.45;\n}\n\nfunction fpsToRGB(value) {\n  return {\n    r: Math.max(0.0, Math.min(1.0, 1.0 - (value/60))),\n    g: Math.max(0.0, Math.min(1.0, ((value-15)/(MAX_FPS-15)))),\n    b: Math.max(0.0, Math.min(1.0, ((value-15)/(MAX_FPS-15))))\n  };\n}\n\nlet now = (window.performance && performance.now) ? performance.now.bind(performance) : Date.now;\n\nexport class StatsViewer extends Node {\n  constructor() {\n    super();\n\n    this._performance_monitoring = false;\n\n    this._start_time = now();\n    this._prev_frame_time = this._start_time;\n    this._prev_graph_update_time = this._start_time;\n    this._frames = 0;\n    this._fps_average = 0;\n    this._fps_min = 0;\n    this._fps_step = this._performance_monitoring ? 1000 : 250;\n    this._last_segment = 0;\n\n    this._fps_vertex_buffer = null;\n    this._fps_render_primitive = null;\n    this._fps_node = null;\n\n    this._seven_segment_node = new SevenSegmentText();\n    // Hard coded because it doesn't change:\n    // Scale by 0.075 in X and Y\n    // Translate into upper left corner w/ z = 0.02\n    this._seven_segment_node.matrix = new Float32Array([\n      0.075, 0, 0, 0,\n      0, 0.075, 0, 0,\n      0, 0, 1, 0,\n      -0.3625, 0.3625, 0.02, 1\n    ]);\n  }\n\n  onRendererChanged(renderer) {\n    this.clearNodes();\n\n    let gl = renderer.gl;\n\n    let fps_verts = [];\n    let fps_indices = [];\n\n    // Graph geometry\n    for (let i = 0; i < SEGMENTS; ++i) {\n      // Bar top\n      fps_verts.push(segmentToX(i), fpsToY(0), 0.02, 0.0, 1.0, 1.0);\n      fps_verts.push(segmentToX(i+1), fpsToY(0), 0.02, 0.0, 1.0, 1.0);\n\n      // Bar bottom\n      fps_verts.push(segmentToX(i), fpsToY(0), 0.02, 0.0, 1.0, 1.0);\n      fps_verts.push(segmentToX(i+1), fpsToY(0), 0.02, 0.0, 1.0, 1.0);\n\n      let idx = i * 4;\n      fps_indices.push(idx, idx+3, idx+1,\n                       idx+3, idx, idx+2);\n    }\n\n    function addBGSquare(left, bottom, right, top, z, r, g, b) {\n      let idx = fps_verts.length / 6;\n\n      fps_verts.push(left, bottom, z, r, g, b);\n      fps_verts.push(right, top, z, r, g, b);\n      fps_verts.push(left, top, z, r, g, b);\n      fps_verts.push(right, bottom, z, r, g, b);\n\n      fps_indices.push(idx, idx+1, idx+2,\n                       idx, idx+3, idx+1);\n    };\n\n    // Panel Background\n    addBGSquare(-0.5, -0.5, 0.5, 0.5, 0.0, 0.0, 0.0, 0.125);\n\n    // FPS Background\n    addBGSquare(-0.45, -0.45, 0.45, 0.25, 0.01, 0.0, 0.0, 0.4);\n\n    // 30 FPS line\n    addBGSquare(-0.45, fpsToY(30), 0.45, fpsToY(32), 0.015, 0.5, 0.0, 0.5);\n\n    // 60 FPS line\n    addBGSquare(-0.45, fpsToY(60), 0.45, fpsToY(62), 0.015, 0.2, 0.0, 0.75);\n\n    this._fps_vertex_buffer = renderer.createRenderBuffer(gl.ARRAY_BUFFER, new Float32Array(fps_verts), gl.DYNAMIC_DRAW);\n    let fps_index_buffer = renderer.createRenderBuffer(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(fps_indices));\n\n    let fps_attribs = [\n      new PrimitiveAttribute(\"POSITION\", this._fps_vertex_buffer, 3, gl.FLOAT, 24, 0),\n      new PrimitiveAttribute(\"COLOR_0\", this._fps_vertex_buffer, 3, gl.FLOAT, 24, 12),\n    ];\n  \n    let fps_primitive = new Primitive(fps_attribs, fps_indices.length);\n    fps_primitive.setIndexBuffer(fps_index_buffer);\n    fps_primitive.setBounds([-0.5, -0.5, 0.0], [0.5, 0.5, 0.015]);\n\n    this._fps_render_primitive = renderer.createRenderPrimitive(fps_primitive, new StatsMaterial());\n    this._fps_node = new Node();\n    this._fps_node.addRenderPrimitive(this._fps_render_primitive);\n    \n    this.addNode(this._fps_node);\n    this.addNode(this._seven_segment_node);\n  }\n\n  get performance_monitoring() {\n    return this._performance_monitoring;\n  }\n\n  set performance_monitoring(value) {\n    this._performance_monitoring = value;\n    this._fps_step = value ? 1000 : 250;\n  }\n\n  begin() {\n    this._start_time = now();\n  }\n\n  end() {\n    let time = now();\n\n    let frame_fps = 1000 / (time - this._prev_frame_time);\n    this._prev_frame_time = time;\n    this._fps_min = this._frames ? Math.min(this._fps_min, frame_fps) : frame_fps;\n    this._frames++;\n\n    if (time > this._prev_graph_update_time + this._fps_step) {\n      let interval_time = time - this._prev_graph_update_time;\n      this._fps_average = Math.round(1000 / (interval_time / this._frames));\n\n      // Draw both average and minimum FPS for this period\n      // so that dropped frames are more clearly visible.\n      this._updateGraph(this._fps_min, this._fps_average);\n      if (this.enable_performance_monitoring) {\n        console.log(`Average FPS: ${this._fps_average} Min FPS: ${this._fps_min}`);\n      }\n\n      this._prev_graph_update_time = time;\n      this._frames = 0;\n      this._fps_min = 0;\n    }\n  }\n\n  _updateGraph(value_low, value_high) {\n    let color = fpsToRGB(value_low);\n    // Draw a range from the low to high value. Artificially widen the\n    // range a bit to ensure that near-equal values still remain\n    // visible - the logic here should match that used by the\n    // \"60 FPS line\" setup below. Hitting 60fps consistently will\n    // keep the top half of the 60fps background line visible.\n    let y0 = fpsToY(value_low - 1);\n    let y1 = fpsToY(value_high + 1);\n\n    // Update the current segment with the new FPS value\n    let updateVerts = [\n      segmentToX(this._last_segment), y1, 0.02, color.r, color.g, color.b,\n      segmentToX(this._last_segment+1), y1, 0.02, color.r, color.g, color.b,\n      segmentToX(this._last_segment), y0, 0.02, color.r, color.g, color.b,\n      segmentToX(this._last_segment+1), y0, 0.02, color.r, color.g, color.b,\n    ];\n\n    // Re-shape the next segment into the green \"progress\" line\n    color.r = 0.2;\n    color.g = 1.0;\n    color.b = 0.2;\n\n    if (this._last_segment == SEGMENTS - 1) {\n      // If we're updating the last segment we need to do two bufferSubDatas\n      // to update the segment and turn the first segment into the progress line.\n      this._renderer.updateRenderBuffer(this._fps_vertex_buffer, new Float32Array(updateVerts), this._last_segment * 24 * 4);\n      updateVerts = [\n        segmentToX(0), fpsToY(MAX_FPS), 0.02, color.r, color.g, color.b,\n        segmentToX(.25), fpsToY(MAX_FPS), 0.02, color.r, color.g, color.b,\n        segmentToX(0), fpsToY(0), 0.02, color.r, color.g, color.b,\n        segmentToX(.25), fpsToY(0), 0.02, color.r, color.g, color.b\n      ];\n      this._renderer.updateRenderBuffer(this._fps_vertex_buffer, new Float32Array(updateVerts), 0);\n    } else {\n      updateVerts.push(\n        segmentToX(this._last_segment+1), fpsToY(MAX_FPS), 0.02, color.r, color.g, color.b,\n        segmentToX(this._last_segment+1.25), fpsToY(MAX_FPS), 0.02, color.r, color.g, color.b,\n        segmentToX(this._last_segment+1), fpsToY(0), 0.02, color.r, color.g, color.b,\n        segmentToX(this._last_segment+1.25), fpsToY(0), 0.02, color.r, color.g, color.b\n      );\n      this._renderer.updateRenderBuffer(this._fps_vertex_buffer, new Float32Array(updateVerts), this._last_segment * 24 * 4);\n    }\n\n    this._last_segment = (this._last_segment+1) % SEGMENTS;\n\n    this._seven_segment_node.text = `${this._fps_average} FP5`;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/stats-viewer.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nRenders simple text using a seven-segment LED style pattern. Only really good\nfor numbers and a limited number of other characters.\n*/\n\nimport { Material } from '../core/material.js'\nimport { Node } from '../core/node.js'\nimport { Primitive, PrimitiveAttribute } from '../core/primitive.js'\n\nconst TEXT_KERNING = 2.0;\n\nclass SevenSegmentMaterial extends Material {\n  get material_name() {\n    return 'SEVEN_SEGMENT_TEXT';\n  }\n\n  get vertex_source() {\n    return `\n    attribute vec2 POSITION;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      return proj * view * model * vec4(POSITION, 0.0, 1.0);\n    }`;\n  }\n\n  get fragment_source() {\n    return `\n    precision mediump float;\n    const vec4 color = vec4(0.0, 1.0, 0.0, 1.0);\n\n    vec4 fragment_main() {\n      return color;\n    }`;\n  }\n}\n\nexport class SevenSegmentText extends Node {\n  constructor() {\n    super();\n\n    this._text = \"\";\n    this._char_nodes = [];\n  }\n\n  onRendererChanged(renderer) {\n    this.clearNodes();\n    this._char_nodes = [];\n\n    let vertices = [];\n    let segmentIndices = {};\n    let indices = [];\n\n    const width = 0.5;\n    const thickness = 0.25;\n\n    function defineSegment(id, left, top, right, bottom) {\n      var idx = vertices.length / 2;\n      vertices.push(\n          left, top,\n          right, top,\n          right, bottom,\n          left, bottom);\n\n      segmentIndices[id] = [\n          idx, idx+2, idx+1,\n          idx, idx+3, idx+2];\n    }\n\n    let characters = {};\n    function defineCharacter(c, segments) {\n      var character = {\n        character: c,\n        offset: indices.length * 2,\n        count: 0\n      };\n\n      for (var i = 0; i < segments.length; ++i) {\n        var idx = segments[i];\n        var segment = segmentIndices[idx];\n        character.count += segment.length;\n        indices.push.apply(indices, segment);\n      }\n\n      characters[c] = character;\n    }\n\n    /* Segment layout is as follows:\n\n    |-0-|\n    3   4\n    |-1-|\n    5   6\n    |-2-|\n\n    */\n\n    defineSegment(0, -1, 1, width, 1-thickness);\n    defineSegment(1, -1, thickness*0.5, width, -thickness*0.5);\n    defineSegment(2, -1, -1+thickness, width, -1);\n    defineSegment(3, -1, 1, -1+thickness, -thickness*0.5);\n    defineSegment(4, width-thickness, 1, width, -thickness*0.5);\n    defineSegment(5, -1, thickness*0.5, -1+thickness, -1);\n    defineSegment(6, width-thickness, thickness*0.5, width, -1);\n\n\n    defineCharacter(\"0\", [0, 2, 3, 4, 5, 6]);\n    defineCharacter(\"1\", [4, 6]);\n    defineCharacter(\"2\", [0, 1, 2, 4, 5]);\n    defineCharacter(\"3\", [0, 1, 2, 4, 6]);\n    defineCharacter(\"4\", [1, 3, 4, 6]);\n    defineCharacter(\"5\", [0, 1, 2, 3, 6]);\n    defineCharacter(\"6\", [0, 1, 2, 3, 5, 6]);\n    defineCharacter(\"7\", [0, 4, 6]);\n    defineCharacter(\"8\", [0, 1, 2, 3, 4, 5, 6]);\n    defineCharacter(\"9\", [0, 1, 2, 3, 4, 6]);\n    defineCharacter(\"A\", [0, 1, 3, 4, 5, 6]);\n    defineCharacter(\"B\", [1, 2, 3, 5, 6]);\n    defineCharacter(\"C\", [0, 2, 3, 5]);\n    defineCharacter(\"D\", [1, 2, 4, 5, 6]);\n    defineCharacter(\"E\", [0, 1, 2, 4, 6]);\n    defineCharacter(\"F\", [0, 1, 3, 5]);\n    defineCharacter(\"P\", [0, 1, 3, 4, 5]);\n    defineCharacter(\"-\", [1]);\n    defineCharacter(\" \", []);\n    defineCharacter(\"_\", [2]); // Used for undefined characters\n\n    let gl = renderer.gl;\n    let vertex_buffer = renderer.createRenderBuffer(gl.ARRAY_BUFFER, new Float32Array(vertices));\n    let index_buffer = renderer.createRenderBuffer(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices));\n\n    let vertex_attribs = [\n      new PrimitiveAttribute(\"POSITION\", vertex_buffer, 2, gl.FLOAT, 8, 0),\n    ];\n    \n    let primitive = new Primitive(vertex_attribs, indices.length);\n    primitive.setIndexBuffer(index_buffer);\n\n    let material = new SevenSegmentMaterial();\n\n    this._char_primitives = {};\n    for (let char in characters) {\n      let char_def = characters[char];\n      primitive.element_count = char_def.count;\n      primitive.index_byte_offset = char_def.offset;\n      this._char_primitives[char] = renderer.createRenderPrimitive(primitive, material);\n    }\n\n    this.text = this._text;\n  }\n\n  get text() {\n    return this._text;\n  }\n\n  set text(value) {\n    this._text = value;\n\n    let i = 0;\n    let char_primitive = null;\n    for (; i < value.length; ++i) {\n      if (value[i] in this._char_primitives) {\n        char_primitive = this._char_primitives[value[i]];\n      } else {\n        char_primitive = this._char_primitives[\"_\"];\n      }\n\n      if (this._char_nodes.length <= i) {\n        let node = new Node();\n        node.addRenderPrimitive(char_primitive);\n        let offset = i * TEXT_KERNING;\n        node.translation = [offset, 0, 0];\n        this._char_nodes.push(node);\n        this.addNode(node);\n      } else {\n        // This is sort of an abuse of how these things are expected to work,\n        // but it's the cheapest thing I could think of that didn't break the\n        // world.\n        this._char_nodes[i].clearRenderPrimitives();\n        this._char_nodes[i].addRenderPrimitive(char_primitive);\n        this._char_nodes[i].visible = true;\n      }\n    }\n\n    // If there's any nodes left over make them invisible\n    for (; i < this._char_nodes.length; ++i) {\n      this._char_nodes[i].visible = false;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/seven-segment-text.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { PbrMaterial } from '../materials/pbr.js'\nimport { Node } from '../core/node.js'\nimport { Primitive, PrimitiveAttribute } from '../core/primitive.js'\nimport { ImageTexture, ColorTexture } from '../core/texture.js'\n\nconst GL = WebGLRenderingContext; // For enums\n\nconst GLB_MAGIC = 0x46546C67;\nconst CHUNK_TYPE = {\n  JSON: 0x4E4F534A,\n  BIN: 0x004E4942\n};\n\nfunction isAbsoluteUri (uri) {\n  let absRegEx = new RegExp('^'+window.location.protocol, 'i');\n  return !!uri.match(absRegEx);\n}\n\nfunction isDataUri(uri) {\n  let dataRegEx = /^data:/;\n  return !!uri.match(dataRegEx);\n}\n\nfunction resolveUri(uri, baseUrl) {\n  if (isAbsoluteUri(uri) || isDataUri(uri)) {\n      return uri;\n  }\n  return baseUrl + uri;\n}\n\nfunction getComponentCount(type) {\n  switch (type) {\n    case 'SCALAR': return 1;\n    case 'VEC2': return 2;\n    case 'VEC3': return 3;\n    case 'VEC4': return 4;\n    default: return 0;\n  }\n}\n\n/**\n * GLTF2SceneLoader\n * Loads glTF 2.0 scenes into a renderable node tree.\n */\n\nexport class GLTF2Loader {\n  constructor(renderer) {\n    this.renderer = renderer;\n    this._gl = renderer._gl;\n  }\n\n  loadFromUrl(url) {\n    return fetch(url)\n        .then((response) => {\n          let i = url.lastIndexOf('/');\n          let baseUrl = (i !== 0) ? url.substring(0, i + 1) : '';\n\n          if (url.endsWith('.gltf')) {\n            return response.json().then((json) => {\n              return this.loadFromJson(json, baseUrl);\n            });\n          } else if (url.endsWith('.glb')) {\n            return response.arrayBuffer().then((arrayBuffer) => {\n              return this.loadFromBinary(arrayBuffer, baseUrl);\n            });\n          } else {\n            throw new Error('Unrecognized file extension');\n          }\n        });\n  }\n\n  loadFromBinary(arrayBuffer, baseUrl) {\n    let headerView = new DataView(arrayBuffer, 0, 12);\n    let magic = headerView.getUint32(0, true);\n    let version = headerView.getUint32(4, true);\n    let length = headerView.getUint32(8, true);\n\n    if (magic != GLB_MAGIC) {\n      throw new Error('Invalid magic string in binary header.');\n    }\n\n    if (version != 2) {\n      throw new Error('Incompatible version in binary header.');\n    }\n\n    let chunks = {};\n    let chunkOffset = 12;\n    while (chunkOffset < length) {\n      let chunkHeaderView = new DataView(arrayBuffer, chunkOffset, 8);\n      let chunkLength = chunkHeaderView.getUint32(0, true);\n      let chunkType = chunkHeaderView.getUint32(4, true);\n      chunks[chunkType] = arrayBuffer.slice(chunkOffset + 8, chunkOffset + 8 + chunkLength);\n      chunkOffset += chunkLength + 8;\n    }\n\n    if (!chunks[CHUNK_TYPE.JSON]) {\n      throw new Error('File contained no json chunk.');\n    }\n\n    let decoder = new TextDecoder('utf-8');\n    let jsonString = decoder.decode(chunks[CHUNK_TYPE.JSON]);\n    let json = JSON.parse(jsonString);\n    return this.loadFromJson(json, baseUrl, chunks[CHUNK_TYPE.BIN]);\n  }\n\n  loadFromJson(json, baseUrl, binaryChunk) {\n    if (!json.asset) {\n      throw new Error(\"Missing asset description.\");\n    }\n\n    if (json.asset.minVersion != \"2.0\" && json.asset.version != \"2.0\") {\n      throw new Error(\"Incompatible asset version.\");\n    }\n\n    let buffers = [];\n    if (binaryChunk) {\n      buffers[0] = new GLTF2Resource({}, baseUrl, binaryChunk);\n    } else {\n      for (let buffer of json.buffers) {\n        buffers.push(new GLTF2Resource(buffer, baseUrl));\n      }\n    }\n\n    let bufferViews = [];\n    for (let bufferView of json.bufferViews) {\n      bufferViews.push(new GLTF2BufferView(bufferView, buffers));\n    }\n\n    let images = [];\n    if (json.images) {\n      for (let image of json.images) {\n        images.push(new GLTF2Resource(image, baseUrl));\n      }\n    }\n\n    let textures = [];\n    if (json.textures) {\n      let i = 0;\n      for (let texture of json.textures) {\n        let image = images[texture.source];\n        let glTexture = image.texture(bufferViews);\n        if(texture.sampler) {\n          let sampler = sampler[texture.sampler];\n          glTexture.sampler.min_filter = sampler.minFilter;\n          glTexture.sampler.mag_filter = sampler.magFilter;\n          glTexture.sampler.wrap_s = sampler.wrapS;\n          glTexture.sampler.wrap_t = sampler.wrapT;\n        }\n        textures.push(glTexture);\n      }\n    }\n\n    function getTexture(textureInfo) {\n      if (!textureInfo) {\n        return null;\n      }\n      return textures[textureInfo.index];\n    }\n\n    let materials = [];\n    if (json.materials) {\n      for (let material of json.materials) {\n        let glMaterial = new PbrMaterial();\n        let pbr = material.pbrMetallicRoughness || {};\n\n        glMaterial.base_color_factor.value = pbr.baseColorFactor || [1, 1, 1, 1];\n        glMaterial.base_color.texture = getTexture(pbr.baseColorTexture);\n        glMaterial.metallic_roughness_factor.value = [\n            pbr.metallicFactor || 1.0,\n            pbr.roughnessFactor || 1.0\n        ];\n        glMaterial.metallic_roughness.texture = getTexture(pbr.metallicRoughnessTexture);\n        glMaterial.normal.texture = getTexture(json.normalTexture);\n        glMaterial.occlusion.texture = getTexture(json.occlusionTexture);\n        glMaterial.occlusion_strength.value = (json.occlusionTexture && json.occlusionTexture.strength) ? json.occlusionTexture.strength : 1.0;\n        glMaterial.emissive_factor.value = material.emissiveFactor || [0, 0, 0];\n        glMaterial.emissive.texture = getTexture(json.emissiveTexture);\n        if (!glMaterial.emissive.texture && json.emissiveFactor) {\n          glMaterial.emissive.texture = new ColorTexture(1.0, 1.0, 1.0, 1.0);\n        }\n\n        switch(material.alphaMode) {\n          case \"BLEND\":\n            glMaterial.state.blend = true;\n            break;\n          case \"MASK\":\n            // Not really supported.\n            glMaterial.state.blend = true;\n            break;\n          default: // Includes \"OPAQUE\"\n            glMaterial.state.blend = false;\n        }\n\n        //glMaterial.alpha_mode = material.alphaMode;\n        //glMaterial.alpha_cutoff = material.alphaCutoff;\n        glMaterial.state.cull_face = !(material.doubleSided);\n\n        materials.push(glMaterial);\n      }\n    }\n\n    let accessors = json.accessors;\n\n    let meshes = [];\n    for (let mesh of json.meshes) {\n      let glMesh = new GLTF2Mesh();\n      meshes.push(glMesh);\n\n      for (let primitive of mesh.primitives) {\n        let material = null;\n        if ('material' in primitive) {\n          material = materials[primitive.material];\n        } else {\n          // Create a \"default\" material if the primitive has none.\n          material = new PbrMaterial();\n        }\n\n        let attributes = [];\n        let element_count = 0;\n        /*let glPrimitive = new GLTF2Primitive(primitive, material);\n        glMesh.primitives.push(glPrimitive);*/\n\n        let min = null;\n        let max = null;\n\n        for (let name in primitive.attributes) {\n          let accessor = accessors[primitive.attributes[name]];\n          let bufferView = bufferViews[accessor.bufferView];\n          element_count = accessor.count;\n\n          let glAttribute = new PrimitiveAttribute(\n            name,\n            bufferView.renderBuffer(this.renderer, GL.ARRAY_BUFFER),\n            getComponentCount(accessor.type),\n            accessor.componentType,\n            bufferView.byteStride || 0,\n            accessor.byteOffset || 0\n          );\n          glAttribute.normalized = accessor.normalized || false;\n\n          if (name == \"POSITION\") {\n            min = accessor.min;\n            max = accessor.max;\n          }\n          \n          attributes.push(glAttribute);\n        }\n\n        let glPrimitive = new Primitive(attributes, element_count, primitive.mode);\n\n        if ('indices' in primitive) {\n          let accessor = accessors[primitive.indices];\n          let bufferView = bufferViews[accessor.bufferView];\n\n          glPrimitive.setIndexBuffer(\n            bufferView.renderBuffer(this.renderer, GL.ELEMENT_ARRAY_BUFFER),\n            accessor.byteOffset || 0,\n            accessor.componentType\n          );\n          glPrimitive.indexType = accessor.componentType;\n          glPrimitive.indexByteOffset = accessor.byteOffset || 0;\n          glPrimitive.element_count = accessor.count;\n        }\n\n        if (min && max) {\n          glPrimitive.setBounds(min, max);\n        }\n\n        // After all the attributes have been processed, get a program that is\n        // appropriate for both the material and the primitive attributes.\n        glMesh.primitives.push(\n            this.renderer.createRenderPrimitive(glPrimitive, material));\n      }\n    }\n\n    let scene_node = new Node();\n    let scene = json.scenes[json.scene];\n    for (let nodeId of scene.nodes) {\n      let node = json.nodes[nodeId];\n      scene_node.addNode(\n          this.processNodes(node, json.nodes, meshes));\n    }\n\n    return scene_node;\n  }\n\n  processNodes(node, nodes, meshes) {\n    let glNode = new Node();\n    glNode.name = node.name;\n\n    if ('mesh' in node) {\n      let mesh = meshes[node.mesh];\n      for (let primitive of mesh.primitives) {\n        glNode.addRenderPrimitive(primitive);\n      }\n    }\n\n    if (node.matrix) {\n      glNode.matrix = new Float32Array(node.matrix);\n    } else if (node.translation || node.rotation || node.scale) {\n      if (node.translation)\n        glNode.translation = new Float32Array(node.translation);\n\n      if (node.rotation)\n        glNode.rotation = new Float32Array(node.rotation);\n\n      if (node.scale)\n        glNode.scale = new Float32Array(node.scale);\n    }\n\n    if (node.children) {\n      for (let nodeId of node.children) {\n        let node = nodes[nodeId];\n        glNode.addNode(this.processNodes(node, nodes, meshes));\n      }\n    }\n\n    return glNode;\n  }\n}\n\nclass GLTF2Mesh {\n  constructor() {\n    this.primitives = [];\n  }\n}\n\nclass GLTF2BufferView {\n  constructor(json, buffers) {\n    this.buffer = buffers[json.buffer];\n    this.byteOffset = json.byteOffset || 0;\n    this.byteLength = json.byteLength || null;\n    this.byteStride = json.byteStride;\n\n    this._viewPromise = null;\n    this._renderBuffer = null;\n  }\n\n  dataView() {\n    if (!this._viewPromise) {\n      this._viewPromise = this.buffer.arrayBuffer().then((arrayBuffer) => {\n        return new DataView(arrayBuffer, this.byteOffset, this.byteLength);\n      });\n    }\n    return this._viewPromise;\n  }\n\n  renderBuffer(renderer, target) {\n    if (!this._renderBuffer) {\n      this._renderBuffer = renderer.createRenderBuffer(target, this.dataView());\n    }\n    return this._renderBuffer;\n  }\n}\n\nclass GLTF2Resource {\n  constructor(json, baseUrl, arrayBuffer) {\n    this.json = json;\n    this.baseUrl = baseUrl;\n\n    this._dataPromise = null;\n    this._texture = null;\n    if (arrayBuffer) {\n      this._dataPromise = Promise.resolve(arrayBuffer);\n    }\n  }\n\n  arrayBuffer() {\n    if (!this._dataPromise) {\n      if (isDataUri(this.json.uri)) {\n        let base64String = this.json.uri.replace('data:application/octet-stream;base64,', '');\n        let binaryArray = Uint8Array.from(atob(base64String), c => c.charCodeAt(0));\n        this._dataPromise = Promise.resolve(binaryArray.buffer);\n        return this._dataPromise;\n      }\n\n      this._dataPromise = fetch(resolveUri(this.json.uri, this.baseUrl))\n          .then((response) => response.arrayBuffer());\n    }\n    return this._dataPromise;\n  }\n\n  texture(bufferViews) {\n    if (!this._texture) {\n      let img = new Image();\n      this._texture = new ImageTexture(img);\n\n      if (this.json.uri) {\n        if (isDataUri(this.json.uri)) {\n          img.src = this.json.uri;\n        } else {\n          img.src = `${this.baseUrl}${this.json.uri}`;\n        }\n      } else {\n        let view = bufferViews[this.json.bufferView];\n        view.dataView().then((dataView) => {\n          let blob = new Blob([dataView], { type: this.json.mimeType } );\n          img.src = window.URL.createObjectURL(blob);\n        });\n      }\n    }\n    return this._texture;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/gltf2.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport { Scene } from './scene.js'\nimport { GLTF2Loader } from '../loaders/gltf2.js'\n\nexport class GLTF2Scene extends Scene {\n  constructor(url) {\n    super();\n\n    this.url = url;\n    this.gltf_node = null;\n  }\n\n  onRendererChanged(renderer) {\n    return this.gltf2Loader.loadFromUrl(this.url).then((scene_node) => {\n      this.gltf_node = scene_node;\n      this.addNode(this.gltf_node);\n      return this.waitForComplete();\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/scenes/gltf2.js"],"sourceRoot":""}